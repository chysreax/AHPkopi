<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP Analysis: Specialized Coffee Offering</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #3E2723; /* Darkest Brown */
            color: #F5F5F5; /* MODIFIED: Using the off-white you defined for the dark theme */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #4A0072; /* Dark Deep Purple */
            color: #FFFFFF; /* White */
            padding: 25px 0;
            text-align: center;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3); /* Subtle purple glow */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 600;
        }

        h2 {
            color: #BA68C8; /* Medium Purple */
            border-bottom: 2px solid #7E57C2; /* Deeper Purple */
            padding-bottom: 10px;
            margin-top: 40px;
            font-size: 2em;
        }

        h3 { /* Maintained your dark theme H3 */
            color: #BA68C8; /* Medium Purple, consistent with H2 accent */
            margin-top: 30px;
            font-size: 1.4em;
        }
         h4 { /* From dark theme */
            color: #CE93D8;
            margin-top: 20px;
            font-size: 1.2em;
        }


        .content-section { /* KEEP THIS ONE - for dark theme */
            background-color: #5D4037; /* Dark Brown - lighter than body */
            color: #F5F5F5; /* Ensure text within content section is light */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .content-section ul { /* From dark theme styling for lists */
            list-style-type: none;
            padding-left: 0;
        }
        .content-section ul ul {
            padding-left: 25px;
        }

        .content-section li { /* From dark theme styling */
            margin-bottom: 12px;
            font-size: 1.05em;
        }
         .content-section li .criterion-item, .content-section li .subcriterion-item, .content-section li .alternative-item {
            display: block;
            margin-bottom: 5px;
        }
        .content-section li .criterion-label, .content-section li .subcriterion-label, .content-section li .alternative-label {
            font-weight: 600;
            color: #E1BEE7;
        }
        .content-section li .description {
            font-size: 0.95em;
            color: #CFD8DC;
            padding-left: 10px;
        }

        .content-section p { /* From dark theme styling */
            font-size: 1.05em;
            margin-bottom: 15px;
            color: #F5F5F5; /* Ensure paragraph text is light */
        }

        #ahpGraphContainer { /* From dark theme - this is good */
            width: 100%;
            border-radius: 15px;
            background-color: #4E342E;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #ahpGraph { /* Ensure this uses dark theme colors or is transparent */
            width: 100%;
            border-radius: 15px;
            /* background-color: #FFFFFF; REMOVE THIS or change to #4E342E or transparent */
            /* padding: 15px; REMOVE PADDING if #ahpGraphContainer has it */
            /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); REMOVE if #ahpGraphContainer has it */
        }


        .code-like { /* From dark theme */
            font-family: 'Courier New', Courier, monospace;
            background-color: #6D4C41;
            padding: 3px 6px;
            border-radius: 5px;
            color: #F5F5F5;
            font-size: 0.95em;
        }

        strong, .emphasis { /* From dark theme */
            color: #BA68C8;
            font-weight: 600;
        }
         a { /* From dark theme */
            color: #CE93D8;
            text-decoration: none;
        }
        a:hover { /* From dark theme */
            color: #AB47BC;
            text-decoration: underline;
        }


        /* Custom scrollbar for a bit more theme consistency - WebKit browsers */
        ::-webkit-scrollbar {
            width: 12px; /* Adjusted to match dark theme's scrollbar */
        }

        ::-webkit-scrollbar-track {
            background: #5D4037; /* Dark Brown */
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #7B1FA2; /* Medium Purple */
            border-radius: 10px;
            border: 2px solid #5D4037;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9C27B0; /* Brighter Purple */
        }

    </style>
</head>
<body>
    <header>
        <h1>AHP Analysis: Pilihan Spesialisasi Kopi</h1>
    </header>

<div class="container">
        <div class="content-section">
            <h2>Menjelaskan Grafik Hirarki AHP</h2>
            <p>Grafik interaktif di bawah ini memvisualisasikan proses pengambilan keputusan terstruktur untuk memilih penawaran kopi premium baru "Fitur Asal Tunggal" (Single Origin Feature). Model Proses Hirarki Analitik (AHP) ini memecah keputusan kompleks menjadi tingkatan-tingkatan hirarkis yang mudah dikelola. Mari kita telaah setiap tingkatan secara rinci:</p>

            <h4>Tingkat 1: Tujuan (Goal)</h4>
            <p>Di puncak hirarki kita, yang direpresentasikan oleh node berbentuk berlian terbesar, adalah tujuan utama:</p>
            <ul>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Memilih Penawaran Fitur Asal Tunggal Baru yang Optimal:</span>
                        <span class="description">Ini adalah keputusan utama yang ingin dibuat oleh kedai kopi kita – untuk memilih kombinasi terbaik dari biji kopi asal tunggal dan metode penyeduhan manual untuk dijadikan sebagai penawaran premium. Semua tingkatan berikutnya berfungsi untuk mengevaluasi opsi-opsi terhadap tujuan menyeluruh ini.</span>
                    </span>
                </li>
            </ul>

            <h4>Tingkat 2: Kriteria (Criteria)</h4>
            <p>Bercabang langsung dari Tujuan adalah empat <span class="emphasis">Kriteria</span> utama. Ini adalah faktor-faktor tingkat tinggi utama yang dianggap penting untuk membuat keputusan terbaik. Dalam analisis AHP penuh, kriteria-kriteria ini akan diberi bobot berdasarkan kepentingan relatifnya dalam mencapai Tujuan. Kriteria-kriterianya adalah:</p>
            <ul>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Rasa & Kualitas Istimewa:</span>
                        <span class="description">Kriteria ini menilai profil rasa inheren dan kualitas sensorik keseluruhan dari penawaran kopi yang potensial. Ini tentang seberapa enak rasa dan sensasi kopi tersebut.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Daya Tarik Pelanggan & Keunikan:</span>
                        <span class="description">Ini berfokus pada seberapa menarik dan khas penawaran tersebut bagi pelanggan. Ini mempertimbangkan kemudahan pemasaran dan kemampuannya untuk menonjol.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Keterampilan Barista & Konsistensi:</span>
                        <span class="description">Kriteria ini mengevaluasi kepraktisan dalam menyiapkan penawaran kopi, berfokus pada kemudahan melatih staf dan kemampuan untuk menghasilkan kualitas tinggi secara konsisten.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Cerita Pengadaan & Karakteristik Biji Kopi:</span>
                        <span class="description">Ini menggali latar belakang biji kopi itu sendiri, termasuk asal-usulnya, metode pemrosesannya, dan narasi menarik apa pun (seperti pengadaan etis) yang menambah nilai.</span>
                    </span>
                </li>
            </ul>

            <h4>Tingkat 3: Sub-Kriteria (Sub-Criteria)</h4>
            <p>Setiap Kriteria Tingkat 2 dipecah lebih lanjut menjadi <span class="emphasis">Sub-Kriteria</span> yang lebih spesifik dan terukur. Ini memberikan tingkat detail yang lebih granular untuk evaluasi. Grafik menunjukkan node-node melingkar yang lebih kecil ini terhubung ke Kriteria induknya:</p>
            <ul>
                <li>
                    <span class="criterion-item"><span class="criterion-label">Di bawah "Rasa & Kualitas Istimewa":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Kejelasan Nota Rasa:</span> <span class="description">Seberapa jelas dan mudah dikenali nota rasa individual (misalnya, buah-buahan, bunga, cokelat)?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Kekentalan (Body) & Sensasi di Mulut (Mouthfeel):</span> <span class="description">Bagaimana sensasi kopi di mulut (misalnya, ringan, berat, seperti sirup, lembut)?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Intensitas Aroma:</span> <span class="description">Seberapa kuat dan memikat aroma kopi tersebut?</span></span></li>
                    </ul>
                </li>
                <li>
                    <span class="criterion-item"><span class="criterion-label">Di bawah "Daya Tarik Pelanggan & Keunikan":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Persepsi Nilai:</span> <span class="description">Apakah pelanggan akan merasa penawaran tersebut sepadan dengan harganya?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Instagrammability:</span> <span class="description">Seberapa menarik secara visual kopi atau proses pembuatannya untuk dibagikan di media sosial?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Faktor Kebaruan:</span> <span class="description">Seberapa baru atau tidak umum penawaran ini dibandingkan dengan sajian kedai kopi pada umumnya atau item menu yang sudah ada?</span></span></li>
                    </ul>
                </li>
                <li>
                    <span class="criterion-item"><span class="criterion-label">Di bawah "Keterampilan Barista & Konsistensi":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Kemudahan Pelatihan:</span> <span class="description">Seberapa cepat dan efektif barista dapat diajari untuk menyiapkan penawaran ini dengan standar tinggi?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Reproduktibilitas:</span> <span class="description">Dapatkah kualitas penawaran direplikasi secara konsisten oleh barista yang berbeda dan pada waktu yang berbeda?</span></span></li>
                    </ul>
                </li>
                 <li>
                    <span class="criterion-item"><span class="criterion-label">Di bawah "Cerita Pengadaan & Karakteristik Biji Kopi":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Reputasi Asal:</span> <span class="description">Apakah asal biji kopi (misalnya, Aceh Gayo, Flores Bajawa) memiliki reputasi kualitas atau karakteristik unik?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Dampak Pemrosesan:</span> <span class="description">Bagaimana metode pemrosesan biji (Washed, Dry, Honey) berkontribusi pada rasa dan daya tarik uniknya?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Cerita Etis:</span> <span class="description">Apakah ada narasi pengadaan etis yang menarik atau hubungan perdagangan langsung yang dapat ditonjolkan?</span></span></li>
                    </ul>
                </li>
            </ul>

            <h4>Tingkat 4: Alternatif (Alternatives)</h4>
            <p>Terakhir, di bagian bawah hirarki, yang direpresentasikan oleh node berbentuk heksagonal, adalah <span class="emphasis">Alternatif</span>. Ini adalah kombinasi penawaran kopi konkret yang berbeda yang sedang dipilih oleh kedai kopi. Setiap Alternatif akan dievaluasi terhadap semua Sub-Kriteria dari Tingkat 3. Grafik memvisualisasikan ini dengan menunjukkan garis yang menghubungkan setiap Sub-Kriteria ke semua Alternatif, menandakan fase evaluasi ini. Lima alternatif spesifik yang dipertimbangkan adalah:</p>
            <ul>
                <li><span class="alternative-item"><span class="alternative-label">Alternatif 1: Aceh Gayo (Proses Basah/Washed) via V60</span> <span class="description"> - Biji kopi Indonesia yang terkenal, dengan proses basah yang bersih, disiapkan menggunakan metode pour-over V60 yang dikenal karena kejernihannya.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternatif 2: Mandailing (Proses Kering/Dry) via French Press</span> <span class="description"> - Biji kopi Indonesia lainnya, berpotensi menawarkan nota buah dari proses kering, disiapkan dengan French Press untuk kekentalan yang lebih penuh.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternatif 3: Toraja (Proses Basah/Washed) via V60</span> <span class="description"> - Biji kopi Sulawesi dengan proses basah, kembali menggunakan V60, kemungkinan menawarkan nuansa rasa yang berbeda dari Gayo.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternatif 4: Flores Bajawa (Proses Madu/Honey) via Cold Brew</span> <span class="description"> - Biji kopi Indonesia yang menggunakan proses madu untuk potensi rasa manis dan kekentalan unik, disiapkan sebagai Cold Brew yang lembut.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternatif 5: Aceh Gayo (Proses Basah/Washed) via Tubruk</span> <span class="description"> - Biji Gayo yang sama dengan Alternatif 1, tetapi disiapkan dengan gaya "Tubruk" tradisional Indonesia (tanpa filter), menawarkan tekstur dan pengalaman rasa yang sangat berbeda.</span></span></li>
            </ul>
            <p>Dengan bekerja secara sistematis melalui hirarki ini, memberikan bobot, dan menilai alternatif, metode AHP memungkinkan proses pengambilan keputusan yang kuat dan transparan untuk memilih penawaran fitur asal tunggal baru yang optimal.</p>
        </div> <!-- Akhir dari content-section "Menjelaskan Grafik Hirarki AHP" -->

        <div class="content-section">
            <h2 id="ahpCalculationSteps">Simulasi Perhitungan AHP (dengan Bobot Asumsi)</h2>
            <p>Proses Hirarki Analitik (AHP) beralih dari struktur kualitatif (grafik) ke hasil kuantitatif dengan menggunakan sistem perbandingan berpasangan untuk mendapatkan bobot kriteria dan skor untuk alternatif. Untuk simulasi ini, kita akan <span class="emphasis">mengasumsikan</span> bobot dan skor ini, beserta justifikasi untuk asumsi kita, untuk mengilustrasikan bagaimana keputusan akhir dapat dicapai.</p>
            <p>Dalam studi AHP yang sebenarnya, para pemangku kepentingan akan membandingkan elemen secara berpasangan (misalnya, "Apakah Kualitas Rasa jauh lebih penting daripada Daya Tarik Pelanggan?"). Teknik matematika (sering melibatkan aljabar matriks) kemudian digunakan untuk menghitung bobot. Di sini, kita akan menetapkan bobot yang masuk akal secara langsung.</p>

            <h3>Langkah 1: Menetapkan Bobot untuk Kriteria Tingkat 2</h3>
            <p>Kita perlu memutuskan kepentingan relatif dari kriteria utama kita dalam mencapai Tujuan ("Memilih Penawaran Fitur Asal Tunggal Baru yang Optimal"). Bobot ini harus berjumlah 1.0 (atau 100%).</p>
            <ul>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Rasa & Kualitas Istimewa (C1):</span> Bobot = <span class="emphasis">0.40</span>
                        <span class="description">Justifikasi: Untuk penawaran kopi spesial premium, rasa dan kualitas aktual adalah yang terpenting. Ini kemungkinan merupakan pendorong kepuasan pelanggan dan bisnis berulang yang paling signifikan.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Daya Tarik Pelanggan & Keunikan (C2):</span> Bobot = <span class="emphasis">0.25</span>
                        <span class="description">Justifikasi: Penawaran perlu menarik pelanggan dan menonjol. Keunikan dapat menuntut harga premium dan menghasilkan buzz.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Cerita Pengadaan & Karakteristik Biji Kopi (C4):</span> Bobot = <span class="emphasis">0.20</span>
                        <span class="description">Justifikasi: Dalam kopi spesial, konsumen semakin tertarik pada asal-usul, pemrosesan, dan aspek etis dari kopi mereka. Cerita yang baik menambah nilai signifikan. (Catatan: Diurutkan ulang sedikit dari grafik untuk alur logis di sini, C4 sebelum C3).</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Keterampilan Barista & Konsistensi (C3):</span> Bobot = <span class="emphasis">0.15</span>
                        <span class="description">Justifikasi: Meskipun penting untuk keberhasilan operasional, jika penawarannya benar-benar istimewa dan menarik, investasi dalam pelatihan dapat dibenarkan. Ini krusial, tetapi mungkin sedikit kurang kritis daripada faktor lain untuk item *premium, unggulan*.</span>
                    </span>
                </li>
            </ul>
            <p><strong>Total Bobot Kriteria:</strong> 0.40 + 0.25 + 0.20 + 0.15 = <span class="emphasis">1.00</span></p>

            <h3>Langkah 2: Menetapkan Bobot Lokal untuk Sub-Kriteria Tingkat 3</h3>
            <p>Untuk setiap kriteria, kita menetapkan bobot lokal untuk sub-kriterianya. Bobot lokal ini berjumlah 1.0 untuk setiap set sub-kriteria di bawah kriteria induk.</p>

            <h4>2.1 Sub-Kriteria di bawah "Rasa & Kualitas Istimewa" (C1 - Bobot 0.40)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Kejelasan Nota Rasa (SC1.1):</span> Bobot Lokal = <span class="emphasis">0.35</span> <span class="description">Justifikasi: Kejelasan tinggi memungkinkan rasa yang berbeda menonjol, indikator utama kualitas.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Kekentalan (Body) & Sensasi di Mulut (SC1.2):</span> Bobot Lokal = <span class="emphasis">0.30</span> <span class="description">Justifikasi: Sensasi taktil adalah komponen utama dari pengalaman kopi.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Intensitas Aroma (SC1.3):</span> Bobot Lokal = <span class="emphasis">0.35</span> <span class="description">Justifikasi: Aroma adalah kesan pertama dan secara signifikan memengaruhi persepsi rasa.</span></span></li>
            </ul>

            <h4>2.2 Sub-Kriteria di bawah "Daya Tarik Pelanggan & Keunikan" (C2 - Bobot 0.25)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Persepsi Nilai (SC2.1):</span> Bobot Lokal = <span class="emphasis">0.40</span> <span class="description">Justifikasi: Pelanggan harus merasa penawaran tersebut sepadan dengan harganya.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Faktor Kebaruan (SC2.3):</span> Bobot Lokal = <span class="emphasis">0.35</span> <span class="description">Justifikasi: Sesuatu yang baru dan berbeda bisa menjadi daya tarik yang kuat.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Instagrammability (SC2.2):</span> Bobot Lokal = <span class="emphasis">0.25</span> <span class="description">Justifikasi: Daya tarik visual mendorong berbagi sosial dan pemasaran, penting untuk tren.</span></span></li>
            </ul>

            <h4>2.3 Sub-Kriteria di bawah "Cerita Pengadaan & Karakteristik Biji Kopi" (C4 - Bobot 0.20)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Cerita Etis (SC4.3):</span> Bobot Lokal = <span class="emphasis">0.40</span> <span class="description">Justifikasi: Transparansi dan pertimbangan etis sangat beresonansi dengan konsumen yang sadar.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Dampak Pemrosesan (SC4.2):</span> Bobot Lokal = <span class="emphasis">0.30</span> <span class="description">Justifikasi: Metode pemrosesan unik (seperti Honey, Natural/Dry) menciptakan rasa dan poin pembicaraan yang khas.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Reputasi Asal (SC4.1):</span> Bobot Lokal = <span class="emphasis">0.30</span> <span class="description">Justifikasi: Asal-usul yang diakui dapat menandakan kualitas, meskipun cerita unik dari asal yang kurang dikenal juga bisa menarik.</span></span></li>
            </ul>

            <h4>2.4 Sub-Kriteria di bawah "Keterampilan Barista & Konsistensi" (C3 - Bobot 0.15)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Reproduktibilitas (SC3.2):</span> Bobot Lokal = <span class="emphasis">0.60</span> <span class="description">Justifikasi: Memastikan setiap cangkir memenuhi standar kualitas sangat penting untuk kepercayaan pelanggan. Lebih penting daripada kemudahan pelatihan awal untuk item premium.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Kemudahan Pelatihan (SC3.1):</span> Bobot Lokal = <span class="emphasis">0.40</span> <span class="description">Justifikasi: Meskipun beberapa pelatihan diharapkan, metode yang terlalu rumit dapat menyebabkan inkonsistensi.</span></span></li>
            </ul>

            <h3>Langkah 3: Menghitung Bobot Global untuk Sub-Kriteria</h3>
            <p>Bobot global sub-kriteria menunjukkan kepentingannya relatif terhadap Tujuan keseluruhan. Dihitung sebagai: <span class="code-like">Bobot Kriteria Induk × Bobot Lokal Sub-Kriteria</span>.</p>
            <p style="font-size: 0.9em; color: #CFD8DC;">(Contoh Perhitungan: Bobot Global SC1.1 = 0.40 (C1) * 0.35 (Lokal SC1.1) = 0.140)</p>
            <ul>
                <li>SC1.1 (Kejelasan Nota Rasa): 0.40 * 0.35 = <span class="emphasis">0.140</span></li>
                <li>SC1.2 (Kekentalan): 0.40 * 0.30 = <span class="emphasis">0.120</span></li>
                <li>SC1.3 (Aroma): 0.40 * 0.35 = <span class="emphasis">0.140</span></li>
                <li>SC2.1 (Persepsi Nilai): 0.25 * 0.40 = <span class="emphasis">0.100</span></li>
                <li>SC2.3 (Faktor Kebaruan): 0.25 * 0.35 = <span class="emphasis">0.0875</span></li>
                <li>SC2.2 (Instagrammability): 0.25 * 0.25 = <span class="emphasis">0.0625</span></li>
                <li>SC4.3 (Cerita Etis): 0.20 * 0.40 = <span class="emphasis">0.080</span></li>
                <li>SC4.2 (Dampak Pemrosesan): 0.20 * 0.30 = <span class="emphasis">0.060</span></li>
                <li>SC4.1 (Reputasi Asal): 0.20 * 0.30 = <span class="emphasis">0.060</span></li>
                <li>SC3.2 (Reproduktibilitas): 0.15 * 0.60 = <span class="emphasis">0.090</span></li>
                <li>SC3.1 (Kemudahan Pelatihan): 0.15 * 0.40 = <span class="emphasis">0.060</span></li>
            </ul>
            <p><em>(Jumlah Bobot Global harus 1.00: 0.14+0.12+0.14+0.10+0.0875+0.0625+0.08+0.06+0.06+0.09+0.06 = 1.00)</em></p>

            <h3>Langkah 4: Menilai Alternatif terhadap setiap Sub-Kriteria</h3>
            <p>Sekarang, kita mengevaluasi seberapa baik kinerja setiap alternatif pada setiap sub-kriteria. Skor untuk alternatif di bawah setiap sub-kriteria harus berjumlah 1.0. Ini adalah bagian yang paling subjektif dan sangat bergantung pada penilaian ahli (atau, dalam kasus kita, asumsi yang beralasan).</p>

            <div style="overflow-x:auto;">
            <table border="1" style="width:100%; border-collapse: collapse; font-size: 0.9em; color: #F5F5F5;">
                <thead style="background-color: #4A0072; color: #FFFFFF;">
                    <tr>
                        <th style="padding: 8px;">Sub-Kriteria (Bobot Global)</th>
                        <th style="padding: 8px;">A1: Gayo V60 (B)</th>
                        <th style="padding: 8px;">A2: Mandailing FP (K)</th>
                        <th style="padding: 8px;">A3: Toraja V60 (B)</th>
                        <th style="padding: 8px;">A4: Flores CB (M)</th>
                        <th style="padding: 8px;">A5: Gayo Tubruk (B)</th>
                        <th style="padding: 8px;">Cuplikan Justifikasi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Rasa & Kualitas (C1)</strong></td></tr>
                    <tr>
                        <td style="padding: 5px;">SC1.1 Kejelasan Nota Rasa (0.140)</td>
                        <td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.10</td>
                        <td style="padding: 5px; font-size: 0.85em;">V60 unggul; FP/Tubruk lebih rendah karena ampas. Toraja sering dihargai karena kejernihannya.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC1.2 Kekentalan (0.120)</td>
                        <td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.10</td>
                        <td style="padding: 5px; font-size: 0.85em;">FP/Tubruk untuk kekentalan berat. CB Madu bagus. V60 lebih ringan.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC1.3 Aroma (0.140)</td>
                        <td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">Pour-over segar (V60) sangat baik. CB biasanya kurang aromatik.</td>
                    </tr>
                    <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Daya Tarik Pelanggan (C2)</strong></td></tr>
                     <tr>
                        <td style="padding: 5px;">SC2.1 Persepsi Nilai (0.100)</td>
                        <td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">CB Madu unik. V60s dihargai. Tubruk mungkin pasar khusus.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC2.3 Faktor Kebaruan (0.0875)</td>
                        <td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.25</td>
                        <td style="padding: 5px; font-size: 0.85em;">Flores Madu & Tubruk paling baru. Gayo V60 lebih umum.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC2.2 Instagrammability (0.0625)</td>
                        <td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.05</td>
                        <td style="padding: 5px; font-size: 0.85em;">Proses V60 sangat visual. Presentasi CB bisa bagus. FP/Tubruk kurang.</td>
                    </tr>
                    <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Cerita Pengadaan (C4)</strong></td></tr>
                    <tr>
                        <td style="padding: 5px;">SC4.3 Cerita Etis (0.080)</td>
                        <td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">Asumsikan Flores memiliki cerita yang lebih kuat/langsung untuk demo. Yang lain standar.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC4.2 Dampak Pemrosesan (0.060)</td>
                        <td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.05</td>
                        <td style="padding: 5px; font-size: 0.85em;">Pemrosesan Madu & Kering secara inheren lebih berdampak pada cerita daripada Basah. Tubruk adalah metode seduh.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC4.1 Reputasi Asal (0.060)</td>
                        <td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.10</td>
                        <td style="padding: 5px; font-size: 0.85em;">Gayo/Toraja terkenal. Mandailing baik. Flores sedang berkembang.</td>
                    </tr>
                     <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Keterampilan Barista (C3)</strong></td></tr>
                     <tr>
                        <td style="padding: 5px;">SC3.2 Reproduktibilitas (0.090)</td>
                        <td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">CB tertinggi. FP baik. V60 butuh keahlian. Tubruk bisa bervariasi.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC3.1 Kemudahan Pelatihan (0.060)</td>
                        <td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.25</td>
                        <td style="padding: 5px; font-size: 0.85em;">CB, FP, Tubruk paling mudah. V60 membutuhkan pelatihan yang lebih presisi.</td>
                    </tr>
                </tbody>
            </table>
            </div>

            <h3>Langkah 5: Menghitung Skor Akhir dan Menentukan Alternatif Terbaik</h3>
            <p>Skor akhir untuk setiap alternatif adalah jumlah dari skor tertimbang di semua sub-kriteria. Skor Tertimbang = <span class="code-like">Bobot Global Sub-Kriteria × Skor Alternatif pada Sub-Kriteria tersebut</span>.</p>

            <p>Mari kita hitung untuk <span class="alternative-label">Alternatif 1: Aceh Gayo (Proses Basah) via V60</span>:</p>
            <ul style="font-size:0.9em; color: #CFD8DC;">
                <li>vs SC1.1: 0.140 * 0.30 = 0.0420</li>
                <li>vs SC1.2: 0.120 * 0.15 = 0.0180</li>
                <li>vs SC1.3: 0.140 * 0.25 = 0.0350</li>
                <li>vs SC2.1: 0.100 * 0.20 = 0.0200</li>
                <li>vs SC2.3: 0.0875 * 0.10 = 0.00875</li>
                <li>vs SC2.2: 0.0625 * 0.30 = 0.01875</li>
                <li>vs SC4.3: 0.080 * 0.20 = 0.0160</li>
                <li>vs SC4.2: 0.060 * 0.15 = 0.0090</li>
                <li>vs SC4.1: 0.060 * 0.25 = 0.0150</li>
                <li>vs SC3.2: 0.090 * 0.15 = 0.0135</li>
                <li>vs SC3.1: 0.060 * 0.10 = 0.0060</li>
                <li><strong>Total untuk A1 = 0.2020</strong></li>
            </ul>

            <p>Melakukan perhitungan serupa untuk semua alternatif (perhitungan disingkat di sini tetapi akan mengikuti pola yang sama):</p>
            <ul id="finalScoresRecalculated">
                 <li><span class="alternative-label">A1 (Gayo V60):</span> <span class="emphasis">0.2020</span></li>
                <li><span class="alternative-label">A2 (Mandailing FP):</span> <span class="emphasis">0.19775</span></li>
                <li><span class="alternative-label">A3 (Toraja V60):</span> <span class="emphasis">0.2090</span></li>
                <li><span class="alternative-label">A4 (Flores CB):</span> <span class="emphasis">0.25475</span></li>
                <li><span class="alternative-label">A5 (Gayo Tubruk):</span> <span class="emphasis">0.1365</span></li>
            </ul>

            <h3>Kesimpulan Simulasi</h3>
            <p>Berdasarkan bobot dan skor asumsi kita, <span class="alternative-label">Alternatif 4: Flores Bajawa (Proses Madu) via Cold Brew</span> muncul sebagai pilihan teratas dengan skor keseluruhan tertinggi (<span class="emphasis">0.2548</span>).</p>
            <p>Hasil ini menunjukkan bahwa kinerjanya yang kuat dalam hal kebaruan, persepsi nilai, cerita etis, dampak pemrosesan, reproduktibilitas, dan kemudahan pelatihan, dikombinasikan dengan karakteristik rasa yang layak untuk cold brew, mengalahkan kejernihan atau aroma yang berpotensi lebih tinggi dari metode V60 ketika semua faktor dipertimbangkan sesuai dengan prioritas yang kita tetapkan.</p>
            <p>Analisis AHP yang sebenarnya akan melibatkan analisis sensitivitas (memeriksa bagaimana hasilnya berubah jika bobot divariasikan) untuk lebih membangun kepercayaan dalam keputusan tersebut.</p>
        </div> <!-- Akhir dari content-section "Simulasi Perhitungan AHP" -->

        <div class="content-section">
            <h2>Grafik Hirarki AHP untuk Pemilihan Penawaran Kopi</h2>
            <p>Grafik berikut memvisualisasikan struktur AHP 4 tingkat untuk memilih fitur kopi asal tunggal baru. Ini adalah representasi jaringan yang disederhanakan untuk menunjukkan hirarki. Dalam AHP penuh, bobot akan ditetapkan pada setiap tingkat berdasarkan perbandingan berpasangan.</p>
            <div id="ahpGraphContainer">
                 <div id="ahpGraph"></div>
            </div>
        </div> <!-- Akhir dari content-section "Grafik Hirarki AHP" -->
    </div> <!-- Akhir dari .container -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Ensure the graphDiv exists
        const graphDiv = document.getElementById('ahpGraph');
        if (!graphDiv) {
            console.error("Error: The div with ID 'ahpGraph' was not found in the DOM.");
            return;
        }
        if (typeof Plotly === 'undefined') {
            console.error("Error: Plotly library is not loaded. Make sure the script tag for Plotly is in your HTML head.");
            return;
        }

        const ahpData = {
            nodes: [
                // Level 1: Goal
                { id: 'Goal', label: 'Select Optimal New Single<br>Origin Feature Offering', level: 1, group: 1, title: 'GOAL' }, // Changed title for consistency
                // Level 2: Criteria
                { id: 'C1', label: 'Exceptional Flavor<br>& Quality', level: 2, group: 2, title: 'CRITERION' },
                { id: 'C2', label: 'Customer Appeal<br>& Uniqueness', level: 2, group: 2, title: 'CRITERION' },
                { id: 'C3', label: 'Barista Skill<br>& Consistency', level: 2, group: 2, title: 'CRITERION' },
                { id: 'C4', label: 'Sourcing Story<br>& Bean Characteristics', level: 2, group: 2, title: 'CRITERION' },
                // Level 3: Sub-Criteria
                { id: 'SC1.1', label: 'Clarity of Notes', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                { id: 'SC1.2', label: 'Body & Mouthfeel', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                { id: 'SC1.3', label: 'Aroma Intensity', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                { id: 'SC2.1', label: 'Perceived Value', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                { id: 'SC2.2', label: 'Instagrammability', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                { id: 'SC2.3', label: 'Novelty Factor', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                { id: 'SC3.1', label: 'Ease of Training', level: 3, group: 3, title: 'SUB-CRITERION (Skill)' },
                { id: 'SC3.2', label: 'Reproducibility', level: 3, group: 3, title: 'SUB-CRITERION (Skill)' },
                { id: 'SC4.1', label: 'Origin Reputation', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                { id: 'SC4.2', label: 'Processing Impact', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                { id: 'SC4.3', label: 'Ethical Story', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                // Level 4: Alternatives
                { id: 'A1', label: 'Aceh Gayo (Washed)<br>via V60', level: 4, group: 4, title: 'ALTERNATIVE 1' },
                { id: 'A2', label: 'Mandailing (Dry)<br>via French Press', level: 4, group: 4, title: 'ALTERNATIVE 2' },
                { id: 'A3', label: 'Toraja (Washed)<br>via V60', level: 4, group: 4, title: 'ALTERNATIVE 3' },
                { id: 'A4', label: 'Flores Bajawa (Honey)<br>via Cold Brew', level: 4, group: 4, title: 'ALTERNATIVE 4' },
                { id: 'A5', label: 'Aceh Gayo (Washed)<br>via Tubruk', level: 4, group: 4, title: 'ALTERNATIVE 5' }
            ],
            links: [
                // Goal to Criteria
                { source: 'Goal', target: 'C1' }, { source: 'Goal', target: 'C2' }, { source: 'Goal', target: 'C3' }, { source: 'Goal', target: 'C4' },
                // C1 to its Sub-Criteria
                { source: 'C1', target: 'SC1.1' }, { source: 'C1', target: 'SC1.2' }, { source: 'C1', target: 'SC1.3' },
                // C2 to its Sub-Criteria
                { source: 'C2', target: 'SC2.1' }, { source: 'C2', target: 'SC2.2' }, { source: 'C2', target: 'SC2.3' },
                // C3 to its Sub-Criteria
                { source: 'C3', target: 'SC3.1' }, { source: 'C3', target: 'SC3.2' },
                // C4 to its Sub-Criteria
                { source: 'C4', target: 'SC4.1' }, { source: 'C4', target: 'SC4.2' }, { source: 'C4', target: 'SC4.3' },
            ].concat( // Links from Sub-Criteria to Alternatives
                ['SC1.1', 'SC1.2', 'SC1.3', 'SC2.1', 'SC2.2', 'SC2.3', 'SC3.1', 'SC3.2', 'SC4.1', 'SC4.2', 'SC4.3']
                .flatMap(sc => ['A1', 'A2', 'A3', 'A4', 'A5'].map(alt => ({ source: sc, target: alt })))
            )
        };

        // Create a map for quick node lookup AND to store coordinates
        const nodeMap = new Map();
        ahpData.nodes.forEach((node, i) => {
            // Store a copy of the node to avoid modifying the original ahpData.nodes if it's used elsewhere
            // and initialize x, y
            nodeMap.set(node.id, { ...node, originalIndex: i, x: undefined, y: undefined });
        });

        const levels = {};
        // Use nodeMap's values (which are our node copies) to build levels
        // This ensures we are working with the objects that will store coordinates
        Array.from(nodeMap.values()).forEach(node => {
            if (!levels[node.level]) levels[node.level] = [];
            levels[node.level].push(node.id); // Store IDs for easier lookup
        });

        const xSpacing = 280; // Adjusted for better spacing
        const ySpacing = 110; // Adjusted
        let maxYUsed = 0;
        let minYUsed = 0; // To help center the y-axis

        Object.keys(levels).sort((a,b) => parseInt(a)-parseInt(b)).forEach((levelKey, levelIndex) => {
            const nodeIdsInLevel = levels[levelKey];
            const levelWidth = (nodeIdsInLevel.length - 1) * ySpacing;
            let startY = -levelWidth / 2;

            if (parseInt(levelKey) === 1) startY = 0; // Center the goal
            if (parseInt(levelKey) === 4) startY -= ySpacing * 1.2; // Adjust alternatives start slightly

            nodeIdsInLevel.forEach((nodeId, nodeIndexInLevel) => {
                const nodeFromMap = nodeMap.get(nodeId); // Get the node object from nodeMap
                if (nodeFromMap) {
                    nodeFromMap.x = levelIndex * xSpacing;
                    nodeFromMap.y = startY + nodeIndexInLevel * ySpacing;
                    if (nodeFromMap.y > maxYUsed) maxYUsed = nodeFromMap.y;
                    if (nodeFromMap.y < minYUsed) minYUsed = nodeFromMap.y;
                } else {
                    console.error("Node ID from levels not found in nodeMap during positioning:", nodeId);
                }
            });
        });

        // Use the nodes from nodeMap (which now have coordinates) for traces and shapes
        const positionedNodes = Array.from(nodeMap.values());

        const edgeShapes = [];
        ahpData.links.forEach((link, index) => {
            const sourceNode = nodeMap.get(link.source);
            const targetNode = nodeMap.get(link.target);
            if (sourceNode && targetNode &&
                typeof sourceNode.x === 'number' && typeof sourceNode.y === 'number' &&
                typeof targetNode.x === 'number' && typeof targetNode.y === 'number') {
                edgeShapes.push({
                    id: `link-${index}`, // Add ID for hover interaction
                    type: 'line',
                    x0: sourceNode.x, y0: sourceNode.y,
                    x1: targetNode.x, y1: targetNode.y,
                    line: {
                        color: '#757575', // MODIFIED: Neutral light grey for links on dark theme
                        width: 1.5
                    },
                    opacity: 1 // For hover effect later
                });
            } else {
                console.warn(`Skipping link due to missing node or coordinates: ${link.source} -> ${link.target}`);
            }
        });

        const traceNodes = {
            x: positionedNodes.map(n => n.x),
            y: positionedNodes.map(n => n.y),
            text: positionedNodes.map(n => `<b>${n.label.replace(/<br>/g, '\n')}</b>`),
            mode: 'markers+text',
            type: 'scatter',
            marker: {
                size: positionedNodes.map(n => n.level === 1 ? 28 : (n.level === 4 ? 22 : 24)), // Dynamic sizing
                color: positionedNodes.map(n => { // MODIFIED: Dark theme marker colors
                    if (n.level === 1) return '#E040FB'; // Bright Purple (Goal)
                    if (n.level === 2) return '#BA68C8'; // Medium Purple (Criteria)
                    if (n.level === 3) return '#4DB6AC'; // Teal (Sub-Criteria)
                    if (n.level === 4) return '#FFB74D'; // Amber (Alternatives)
                    return '#D1C4E9'; // Fallback light purple
                }),
                symbol: positionedNodes.map(n => { // More distinct symbols
                    if (n.level === 1) return 'diamond-wide';
                    if (n.level === 2) return 'square';
                    if (n.level === 3) return 'circle';
                    if (n.level === 4) return 'hexagon';
                    return 'circle';
                }),
                line: {
                    width: 2,
                    color: '#F5F5F5' // MODIFIED: White border for markers to pop on dark bg
                },
                opacity: positionedNodes.map(() => 1) // For hover effect
            },
            textfont: {
                family: 'Segoe UI, Tahoma, sans-serif',
                size: 10,
                color: '#FFFFFF' // MODIFIED: White text for labels
            },
            textposition: 'middle right',
            hoverinfo: 'text', // Use hovertext for custom tooltip
            hovertext: positionedNodes.map(n => `<b>${n.title}</b><br>${n.label.replace(/<br>/g, ' ')}`),
            customdata: positionedNodes.map(n => ({ id: n.id })) // Store node ID for hover events
        };

        const layout = {
            title: {
                text: 'AHP Hierarchy: Coffee Offering Selection',
                font: {
                    size: 22, // Increased size slightly
                    color: '#E040FB' // MODIFIED: Bright Purple for title
                },
                y: 0.95 // Adjust title position if needed
            },
            shapes: edgeShapes,
            xaxis: {
                showgrid: false, zeroline: false, showticklabels: false,
                range: [-xSpacing * 0.5, xSpacing * 3.5 + 50] // Expanded range slightly
            },
            yaxis: {
                showgrid: false, zeroline: false, showticklabels: false,
                range: [minYUsed - ySpacing, maxYUsed + ySpacing] // Dynamic range based on content
            },
            showlegend: false,
            hovermode: 'closest',
            paper_bgcolor: '#4E342E', // MODIFIED: Dark brown graph area background
            plot_bgcolor: '#4E342E',  // MODIFIED: Dark brown plot background
            margin: { t: 80, b: 40, l: 40, r: 40 },
            height: 750 // Adjusted height
        };

        // Final check before plotting
        let allNodesHaveCoords = positionedNodes.every(n => typeof n.x === 'number' && typeof n.y === 'number');
        if (!allNodesHaveCoords) {
            console.error("CRITICAL: Not all nodes have valid coordinates. Aborting plot.");
            positionedNodes.forEach(n => {
                if (typeof n.x !== 'number' || typeof n.y !== 'number') {
                    console.error(`Node ${n.id} has invalid coords: x=${n.x}, y=${n.y}`);
                }
            });
            return;
        }

        try {
            Plotly.newPlot(graphDiv, [traceNodes], layout, {responsive: true});
        } catch (e) {
            console.error("Error during Plotly.newPlot():", e);
        }


        // --- Hover Interactivity ---
        graphDiv.on('plotly_hover', function (eventData) {
            if (eventData.points.length > 0) {
                const pointIndex = eventData.points[0].pointNumber;
                const hoveredNode = positionedNodes[pointIndex]; // Get from the same array used for plotting
                if (!hoveredNode) return;
                const hoveredNodeId = hoveredNode.id;

                const connectedNodeIds = new Set([hoveredNodeId]);
                ahpData.links.forEach((link) => {
                    if (link.source === hoveredNodeId) connectedNodeIds.add(link.target);
                    if (link.target === hoveredNodeId) connectedNodeIds.add(link.source);
                });

                const newMarkerOpacities = positionedNodes.map(n => connectedNodeIds.has(n.id) ? 1 : 0.2);
                const newMarkerSizes = positionedNodes.map(n => {
                    if (n.id === hoveredNodeId) return n.level === 1 ? 32 : (n.level === 4 ? 26 : 28);
                    return n.level === 1 ? 28 : (n.level === 4 ? 22 : 24);
                });

                Plotly.restyle(graphDiv, {
                    'marker.opacity': [newMarkerOpacities],
                    'marker.size': [newMarkerSizes]
                }, [0]);

                const updatedShapes = edgeShapes.map(shape => {
                    if (!shape) return null;
                    const linkData = ahpData.links[parseInt(shape.id.split('-')[1])];
                    if (!linkData) return shape;

                    const isConnected = (linkData.source === hoveredNodeId && connectedNodeIds.has(linkData.target)) ||
                                        (linkData.target === hoveredNodeId && connectedNodeIds.has(linkData.source));
                    return { ...shape, line: {...shape.line, width: isConnected ? 3 : 1.5, color: isConnected ? '#E040FB' : '#757575'}, opacity: isConnected ? 1 : 0.15 };
                }).filter(shape => shape !== null);
                Plotly.relayout(graphDiv, { shapes: updatedShapes });
            }
        });

        graphDiv.on('plotly_unhover', function (eventData) {
            Plotly.restyle(graphDiv, {
                'marker.opacity': [positionedNodes.map(() => 1)],
                'marker.size': [positionedNodes.map(n => n.level === 1 ? 28 : (n.level === 4 ? 22 : 24))]
            }, [0]);
             const resetShapes = edgeShapes.map(s => {
                if (!s) return null;
                return ({...s, line: {...s.line, width: 1.5, color: '#757575'}, opacity: 1});
            }).filter(shape => shape !== null);
            Plotly.relayout(graphDiv, { shapes: resetShapes });
        });

    });
</script>
</body>
</html>
