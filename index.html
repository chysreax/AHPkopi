<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP Analysis: Specialized Coffee Offering</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #3E2723; /* Darkest Brown */
            color: #F5F5F5; /* MODIFIED: Using the off-white you defined for the dark theme */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #4A0072; /* Dark Deep Purple */
            color: #FFFFFF; /* White */
            padding: 25px 0;
            text-align: center;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3); /* Subtle purple glow */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 600;
        }

        h2 {
            color: #BA68C8; /* Medium Purple */
            border-bottom: 2px solid #7E57C2; /* Deeper Purple */
            padding-bottom: 10px;
            margin-top: 40px;
            font-size: 2em;
        }

        h3 { /* Maintained your dark theme H3 */
            color: #BA68C8; /* Medium Purple, consistent with H2 accent */
            margin-top: 30px;
            font-size: 1.4em;
        }
         h4 { /* From dark theme */
            color: #CE93D8;
            margin-top: 20px;
            font-size: 1.2em;
        }


        .content-section { /* KEEP THIS ONE - for dark theme */
            background-color: #5D4037; /* Dark Brown - lighter than body */
            color: #F5F5F5; /* Ensure text within content section is light */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .content-section ul { /* From dark theme styling for lists */
            list-style-type: none;
            padding-left: 0;
        }
        .content-section ul ul {
            padding-left: 25px;
        }

        .content-section li { /* From dark theme styling */
            margin-bottom: 12px;
            font-size: 1.05em;
        }
         .content-section li .criterion-item, .content-section li .subcriterion-item, .content-section li .alternative-item {
            display: block;
            margin-bottom: 5px;
        }
        .content-section li .criterion-label, .content-section li .subcriterion-label, .content-section li .alternative-label {
            font-weight: 600;
            color: #E1BEE7;
        }
        .content-section li .description {
            font-size: 0.95em;
            color: #CFD8DC;
            padding-left: 10px;
        }

        .content-section p { /* From dark theme styling */
            font-size: 1.05em;
            margin-bottom: 15px;
            color: #F5F5F5; /* Ensure paragraph text is light */
        }

        #ahpGraphContainer { /* From dark theme - this is good */
            width: 100%;
            border-radius: 15px;
            background-color: #4E342E;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #ahpGraph { /* Ensure this uses dark theme colors or is transparent */
            width: 100%;
            border-radius: 15px;
            /* background-color: #FFFFFF; REMOVE THIS or change to #4E342E or transparent */
            /* padding: 15px; REMOVE PADDING if #ahpGraphContainer has it */
            /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); REMOVE if #ahpGraphContainer has it */
        }


        .code-like { /* From dark theme */
            font-family: 'Courier New', Courier, monospace;
            background-color: #6D4C41;
            padding: 3px 6px;
            border-radius: 5px;
            color: #F5F5F5;
            font-size: 0.95em;
        }

        strong, .emphasis { /* From dark theme */
            color: #BA68C8;
            font-weight: 600;
        }
         a { /* From dark theme */
            color: #CE93D8;
            text-decoration: none;
        }
        a:hover { /* From dark theme */
            color: #AB47BC;
            text-decoration: underline;
        }


        /* Custom scrollbar for a bit more theme consistency - WebKit browsers */
        ::-webkit-scrollbar {
            width: 12px; /* Adjusted to match dark theme's scrollbar */
        }

        ::-webkit-scrollbar-track {
            background: #5D4037; /* Dark Brown */
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #7B1FA2; /* Medium Purple */
            border-radius: 10px;
            border: 2px solid #5D4037;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9C27B0; /* Brighter Purple */
        }

    </style>
</head>
<body>
    <header>
        <h1>AHP Analysis: Selecting a Specialized Coffee Offering</h1>
    </header>

    <div class="container">
        <div class="content-section">
            <h2>Explaining the AHP Hierarchy Graph</h2>
            <p>The interactive graph below visualizes the structured decision-making process for selecting a new premium "Single Origin Feature" coffee offering. This Analytical Hierarchy Process (AHP) model breaks down the complex decision into manageable, hierarchical levels. Let's explore each level in detail:</p>

            <h4>Level 1: The Goal</h4>
            <p>At the very top of our hierarchy, represented by the largest, diamond-shaped node, is the ultimate objective:</p>
            <ul>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Select Optimal New Single Origin Feature Offering:</span>
                        <span class="description">This is the primary decision our coffee shop aims to make – to choose the best combination of a single-origin coffee bean and a manual brewing method to feature as a premium offering. All subsequent levels serve to evaluate options against this overarching goal.</span>
                    </span>
                </li>
            </ul>

            <h4>Level 2: Criteria</h4>
            <p>Branching directly from the Goal are four key <span class="emphasis">Criteria</span>. These are the main high-level factors considered essential for making the best decision. In a full AHP analysis, these criteria would be assigned weights based on their relative importance to achieving the Goal. The criteria are:</p>
            <ul>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Exceptional Flavor & Quality:</span>
                        <span class="description">This criterion assesses the inherent taste profile and overall sensory quality of the potential coffee offering. It's about how good the coffee actually tastes and feels.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Customer Appeal & Uniqueness:</span>
                        <span class="description">This focuses on how attractive and distinctive the offering will be to customers. It considers marketability and its ability to stand out.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Barista Skill & Consistency:</span>
                        <span class="description">This criterion evaluates the practicality of preparing the coffee offering, focusing on the ease of training staff and the ability to reproduce high quality consistently.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Sourcing Story & Bean Characteristics:</span>
                        <span class="description">This delves into the background of the coffee bean itself, including its origin, processing method, and any compelling narratives (like ethical sourcing) that add value.</span>
                    </span>
                </li>
            </ul>

            <h4>Level 3: Sub-Criteria</h4>
            <p>Each of the Level 2 Criteria is further broken down into more specific, measurable <span class="emphasis">Sub-Criteria</span>. These provide a more granular level of detail for evaluation. The graph shows these smaller, circular nodes connected to their parent Criterion:</p>
            <ul>
                <li>
                    <span class="criterion-item"><span class="criterion-label">Under "Exceptional Flavor & Quality":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Clarity of Notes:</span> <span class="description">How distinct and identifiable are the individual flavor notes (e.g., fruity, floral, chocolatey)?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Body & Mouthfeel:</span> <span class="description">How does the coffee feel in the mouth (e.g., light, heavy, syrupy, smooth)?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Aroma Intensity:</span> <span class="description">How strong and captivating is the coffee's smell?</span></span></li>
                    </ul>
                </li>
                <li>
                    <span class="criterion-item"><span class="criterion-label">Under "Customer Appeal & Uniqueness":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Perceived Value:</span> <span class="description">Will customers feel the offering is worth its price point?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Instagrammability:</span> <span class="description">How visually appealing is the coffee or its preparation process for social media sharing?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Novelty Factor:</span> <span class="description">How new or uncommon is this offering compared to typical coffee shop fare or existing menu items?</span></span></li>
                    </ul>
                </li>
                <li>
                    <span class="criterion-item"><span class="criterion-label">Under "Barista Skill & Consistency":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Ease of Training:</span> <span class="description">How quickly and effectively can baristas be taught to prepare this offering to a high standard?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Reproducibility:</span> <span class="description">Can the quality of the offering be consistently replicated across different baristas and times?</span></span></li>
                    </ul>
                </li>
                 <li>
                    <span class="criterion-item"><span class="criterion-label">Under "Sourcing Story & Bean Characteristics":</span></span>
                    <ul>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Origin Reputation:</span> <span class="description">Does the coffee bean's origin (e.g., Aceh Gayo, Flores Bajawa) carry a reputation for quality or unique characteristics?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Processing Impact:</span> <span class="description">How does the bean's processing method (Washed, Dry, Honey) contribute to its unique flavor and appeal?</span></span></li>
                        <li><span class="subcriterion-item"><span class="subcriterion-label">Ethical Story:</span> <span class="description">Is there a compelling ethical sourcing narrative or direct trade relationship that can be highlighted?</span></span></li>
                    </ul>
                </li>
            </ul>

            <h4>Level 4: Alternatives</h4>
            <p>Finally, at the bottom of the hierarchy, represented by hexagonal nodes, are the <span class="emphasis">Alternatives</span>. These are the distinct, concrete coffee offering combinations that the coffee shop is choosing between. Each Alternative will be evaluated against all the Sub-Criteria from Level 3. The graph visualizes this by showing lines connecting each Sub-Criterion to all Alternatives, signifying this evaluation phase. The five specific alternatives being considered are:</p>
            <ul>
                <li><span class="alternative-item"><span class="alternative-label">Alternative 1: Aceh Gayo (Washed) via V60</span> <span class="description"> - A well-known Indonesian bean, with a clean washed process, prepared using the V60 pour-over method known for clarity.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternative 2: Mandailing (Dry Processed) via French Press</span> <span class="description"> - Another Indonesian bean, potentially offering fruity notes from dry processing, prepared with a French Press for a fuller body.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternative 3: Toraja (Washed) via V60</span> <span class="description"> - A Sulawesi bean with a washed process, again using the V60, likely offering different flavor nuances than Gayo.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternative 4: Flores Bajawa (Honey Processed) via Cold Brew</span> <span class="description"> - An Indonesian bean using the honey process for potential sweetness and unique body, prepared as a smooth Cold Brew.</span></span></li>
                <li><span class="alternative-item"><span class="alternative-label">Alternative 5: Aceh Gayo (Washed) via Tubruk</span> <span class="description"> - The same Gayo bean as Alternative 1, but prepared in the traditional Indonesian "Tubruk" (unfiltered) style, offering a very different texture and flavor experience.</span></span></li>
            </ul>
            <p>By systematically working through this hierarchy, assigning weights, and scoring alternatives, the AHP method allows for a robust and transparent decision-making process to select the optimal new single origin feature offering.</p>
        <div class="content-section">
            <h2>AHP Calculation Simulation (with Assumed Weights)</h2>
            <p>The Analytical Hierarchy Process (AHP) moves from the qualitative structure (the graph) to quantitative results by using a system of pairwise comparisons to derive weights for criteria and scores for alternatives. For this simulation, we will <span class="emphasis">assume</span> these weights and scores, along with justifications for our assumptions, to illustrate how a final decision can be reached.</p>
            <p>In a real AHP study, stakeholders would compare elements pairwise (e.g., "Is Flavor Quality much more important than Customer Appeal?"). Mathematical techniques (often involving matrix algebra) are then used to calculate the weights. Here, we'll assign plausible weights directly.</p>

            <h3>Step 1: Assigning Weights to Level 2 Criteria</h3>
            <p>We need to decide the relative importance of our main criteria in achieving the Goal ("Select Optimal New Single Origin Feature Offering"). These weights must sum to 1.0 (or 100%).</p>
            <ul>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Exceptional Flavor & Quality (C1):</span> Weight = <span class="emphasis">0.40</span>
                        <span class="description">Justification: For a premium specialty coffee offering, the actual taste and quality are paramount. This is likely the most significant driver of customer satisfaction and repeat business.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Customer Appeal & Uniqueness (C2):</span> Weight = <span class="emphasis">0.25</span>
                        <span class="description">Justification: The offering needs to attract customers and stand out. Uniqueness can command a premium price and generate buzz.</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Sourcing Story & Bean Characteristics (C4):</span> Weight = <span class="emphasis">0.20</span>
                        <span class="description">Justification: In specialty coffee, consumers are increasingly interested in the origin, processing, and ethical aspects of their coffee. A good story adds significant value. (Note: Reordered from graph slightly for logical flow here, C4 before C3).</span>
                    </span>
                </li>
                <li>
                    <span class="criterion-item">
                        <span class="criterion-label">Barista Skill & Consistency (C3):</span> Weight = <span class="emphasis">0.15</span>
                        <span class="description">Justification: While important for operational success, if the offering is truly exceptional and appealing, some investment in training can be justified. It's crucial, but perhaps slightly less critical than the other factors for a *premium, featured* item.</span>
                    </span>
                </li>
            </ul>
            <p><strong>Total Criteria Weight:</strong> 0.40 + 0.25 + 0.20 + 0.15 = <span class="emphasis">1.00</span></p>

            <h3>Step 2: Assigning Local Weights to Level 3 Sub-Criteria</h3>
            <p>For each criterion, we assign local weights to its sub-criteria. These local weights sum to 1.0 for each set of sub-criteria under a parent criterion.</p>

            <h4>2.1 Sub-Criteria under "Exceptional Flavor & Quality" (C1 - Weight 0.40)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Clarity of Notes (SC1.1):</span> Local Weight = <span class="emphasis">0.35</span> <span class="description">Justification: High clarity allows distinct flavors to shine, a key indicator of quality.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Body & Mouthfeel (SC1.2):</span> Local Weight = <span class="emphasis">0.30</span> <span class="description">Justification: The tactile sensation is a major component of the coffee experience.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Aroma Intensity (SC1.3):</span> Local Weight = <span class="emphasis">0.35</span> <span class="description">Justification: Aroma is the first impression and significantly influences perceived taste. (Adjusted to give more weight than previously implied).</span></span></li>
            </ul>

            <h4>2.2 Sub-Criteria under "Customer Appeal & Uniqueness" (C2 - Weight 0.25)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Perceived Value (SC2.1):</span> Local Weight = <span class="emphasis">0.40</span> <span class="description">Justification: Customers must feel the offering is worth the price.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Novelty Factor (SC2.3):</span> Local Weight = <span class="emphasis">0.35</span> <span class="description">Justification: Something new and different can be a strong draw.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Instagrammability (SC2.2):</span> Local Weight = <span class="emphasis">0.25</span> <span class="description">Justification: Visual appeal drives social sharing and marketing, important for trends.</span></span></li>
            </ul>

            <h4>2.3 Sub-Criteria under "Sourcing Story & Bean Characteristics" (C4 - Weight 0.20)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Ethical Story (SC4.3):</span> Local Weight = <span class="emphasis">0.40</span> <span class="description">Justification: Transparency and ethical considerations resonate strongly with conscious consumers.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Processing Impact (SC4.2):</span> Local Weight = <span class="emphasis">0.30</span> <span class="description">Justification: Unique processing methods (like Honey, Natural/Dry) create distinct flavors and talking points.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Origin Reputation (SC4.1):</span> Local Weight = <span class="emphasis">0.30</span> <span class="description">Justification: Well-regarded origins can signal quality, though a unique story from a lesser-known origin can also be compelling.</span></span></li>
            </ul>

            <h4>2.4 Sub-Criteria under "Barista Skill & Consistency" (C3 - Weight 0.15)</h4>
            <ul>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Reproducibility (SC3.2):</span> Local Weight = <span class="emphasis">0.60</span> <span class="description">Justification: Ensuring every cup meets the quality standard is critical for customer trust. More important than initial ease of training for a premium item.</span></span></li>
                <li><span class="subcriterion-item"><span class="subcriterion-label">Ease of Training (SC3.1):</span> Local Weight = <span class="emphasis">0.40</span> <span class="description">Justification: While some training is expected, overly complex methods can lead to inconsistency.</span></span></li>
            </ul>

            <h3>Step 3: Calculating Global Weights for Sub-Criteria</h3>
            <p>The global weight of a sub-criterion shows its importance relative to the overall Goal. It's calculated as: <span class="code-like">Parent Criterion Weight × Sub-Criterion Local Weight</span>.</p>
            <!-- This table could be generated dynamically with JS, but for HTML-only: -->
            <p style="font-size: 0.9em; color: #795548;">(Example Calculation: SC1.1 Global Weight = 0.40 (C1) * 0.35 (SC1.1 Local) = 0.140)</p>
            <ul>
                <li>SC1.1 (Clarity): 0.40 * 0.35 = <span class="emphasis">0.140</span></li>
                <li>SC1.2 (Body): 0.40 * 0.30 = <span class="emphasis">0.120</span></li>
                <li>SC1.3 (Aroma): 0.40 * 0.35 = <span class="emphasis">0.140</span></li>
                <li>SC2.1 (Perceived Value): 0.25 * 0.40 = <span class="emphasis">0.100</span></li>
                <li>SC2.3 (Novelty): 0.25 * 0.35 = <span class="emphasis">0.0875</span></li>
                <li>SC2.2 (Instagrammability): 0.25 * 0.25 = <span class="emphasis">0.0625</span></li>
                <li>SC4.3 (Ethical Story): 0.20 * 0.40 = <span class="emphasis">0.080</span></li>
                <li>SC4.2 (Processing Impact): 0.20 * 0.30 = <span class="emphasis">0.060</span></li>
                <li>SC4.1 (Origin Reputation): 0.20 * 0.30 = <span class="emphasis">0.060</span></li>
                <li>SC3.2 (Reproducibility): 0.15 * 0.60 = <span class="emphasis">0.090</span></li>
                <li>SC3.1 (Ease of Training): 0.15 * 0.40 = <span class="emphasis">0.060</span></li>
            </ul>
            <p><em>(Sum of Global Weights should be 1.00: 0.14+0.12+0.14+0.10+0.0875+0.0625+0.08+0.06+0.06+0.09+0.06 = 1.00)</em></p>

            <h3>Step 4: Scoring Alternatives against each Sub-Criterion</h3>
            <p>Now, we evaluate how well each alternative performs on each sub-criterion. The scores for alternatives under each sub-criterion must sum to 1.0. This is the most subjective part and relies heavily on expert judgment (or, in our case, reasoned assumptions).</p>

            <div style="overflow-x:auto;"> <!-- For smaller screens to scroll table -->
            <table border="1" style="width:100%; border-collapse: collapse; font-size: 0.9em;">
                <thead>
                    <tr style="background-color: #4A0072; color: #FFFFFF;">
                        <th style="padding: 8px;">Sub-Criterion (Global Weight)</th>
                        <th style="padding: 8px;">A1: Gayo V60 (W)</th>
                        <th style="padding: 8px;">A2: Mandailing FP (D)</th>
                        <th style="padding: 8px;">A3: Toraja V60 (W)</th>
                        <th style="padding: 8px;">A4: Flores CB (H)</th>
                        <th style="padding: 8px;">A5: Gayo Tubruk (W)</th>
                        <th style="padding: 8px;">Justification Snippet</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Flavor & Quality (C1)</strong></td></tr>
                    <tr>
                        <td style="padding: 5px;">SC1.1 Clarity (0.140)</td>
                        <td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.10</td>
                        <td style="padding: 5px; font-size: 0.85em;">V60 excels; FP/Tubruk lower due to fines. Toraja often prized for clarity.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC1.2 Body (0.120)</td>
                        <td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.10</td>
                        <td style="padding: 5px; font-size: 0.85em;">FP/Tubruk for heavy body. Honey CB good. V60 lighter.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC1.3 Aroma (0.140)</td>
                        <td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">Fresh pour-overs (V60s) excellent. CB typically less aromatic.</td>
                    </tr>
                    <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Customer Appeal (C2)</strong></td></tr>
                     <tr>
                        <td style="padding: 5px;">SC2.1 Perceived Value (0.100)</td>
                        <td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">Honey CB unique. V60s well-regarded. Tubruk might be niche.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC2.3 Novelty (0.0875)</td>
                        <td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.25</td>
                        <td style="padding: 5px; font-size: 0.85em;">Flores Honey & Tubruk most novel. Gayo V60 more common.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC2.2 Instagrammability (0.0625)</td>
                        <td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.05</td>
                        <td style="padding: 5px; font-size: 0.85em;">V60 process very visual. CB presentation can be good. FP/Tubruk less so.</td>
                    </tr>
                    <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Sourcing Story (C4)</strong></td></tr>
                    <tr>
                        <td style="padding: 5px;">SC4.3 Ethical Story (0.080)</td>
                        <td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">Assume Flores has a stronger traceable/direct story for demo. Others standard.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC4.2 Processing Impact (0.060)</td>
                        <td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.05</td>
                        <td style="padding: 5px; font-size: 0.85em;">Honey & Dry processing inherently more impactful on story than Washed. Tubruk is brew.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC4.1 Origin Reputation (0.060)</td>
                        <td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.10</td>
                        <td style="padding: 5px; font-size: 0.85em;">Gayo/Toraja well known. Mandailing good. Flores emerging.</td>
                    </tr>
                     <tr><td style="padding: 5px;" colspan="7"><strong style="color: #E040FB;">Barista Skill (C3)</strong></td></tr>
                     <tr>
                        <td style="padding: 5px;">SC3.2 Reproducibility (0.090)</td>
                        <td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.20</td><td style="padding: 5px; text-align:center;">0.15</td><td style="padding: 5px; text-align:center;">0.35</td><td style="padding: 5px; text-align:center;">0.15</td>
                        <td style="padding: 5px; font-size: 0.85em;">CB highest. FP good. V60s need skill. Tubruk can vary.</td>
                    </tr>
                    <tr>
                        <td style="padding: 5px;">SC3.1 Ease of Training (0.060)</td>
                        <td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.25</td><td style="padding: 5px; text-align:center;">0.10</td><td style="padding: 5px; text-align:center;">0.30</td><td style="padding: 5px; text-align:center;">0.25</td>
                        <td style="padding: 5px; font-size: 0.85em;">CB, FP, Tubruk easiest. V60s require more precise training.</td>
                    </tr>
                </tbody>
            </table>
            </div>

            <h3>Step 5: Calculating Final Scores and Determining the Best Alternative</h3>
            <p>The final score for each alternative is the sum of its weighted scores across all sub-criteria. Weighted Score = <span class="code-like">Sub-Criterion Global Weight × Alternative's Score on that Sub-Criterion</span>.</p>

            <p>Let's calculate for <span class="alternative-label">Alternative 1: Aceh Gayo (Washed) via V60</span>:</p>
            <ul style="font-size:0.9em; color: #795548;">
                <li>vs SC1.1: 0.140 * 0.30 = 0.0420</li>
                <li>vs SC1.2: 0.120 * 0.15 = 0.0180</li>
                <li>vs SC1.3: 0.140 * 0.25 = 0.0350</li>
                <li>vs SC2.1: 0.100 * 0.20 = 0.0200</li>
                <li>vs SC2.3: 0.0875 * 0.10 = 0.00875</li>
                <li>vs SC2.2: 0.0625 * 0.30 = 0.01875</li>
                <li>vs SC4.3: 0.080 * 0.20 = 0.0160</li>
                <li>vs SC4.2: 0.060 * 0.15 = 0.0090</li>
                <li>vs SC4.1: 0.060 * 0.25 = 0.0150</li>
                <li>vs SC3.2: 0.090 * 0.15 = 0.0135</li>
                <li>vs SC3.1: 0.060 * 0.10 = 0.0060</li>
                <li><strong>Total for A1 = 0.2020</strong></li>
            </ul>

            <p>Performing similar calculations for all alternatives (calculations omitted for brevity here but would follow the same pattern):</p>
            <ul id="finalScores">
                <!-- Placeholder for final scores. In a dynamic app, these would be calculated. -->
                <li><span class="alternative-label">A1: Aceh Gayo (Washed) via V60:</span> <span class="emphasis">0.2020</span></li>
                <li><span class="alternative-label">A2: Mandailing (Dry) via French Press:</span> <span class="emphasis">0.1980</span> (Assumed calculation)</li>
                <li><span class="alternative-label">A3: Toraja (Washed) via V60:</span> <span class="emphasis">0.2085</span> (Assumed calculation)</li>
                <li><span class="alternative-label">A4: Flores Bajawa (Honey) via Cold Brew:</span> <span class="emphasis">0.2555</span> (Assumed calculation)</li>
                <li><span class="alternative-label">A5: Aceh Gayo (Washed) via Tubruk:</span> <span class="emphasis">0.1360</span> (Assumed calculation)</li>
            </ul>
             <p>(Example detailed calculation for A4 to show the process):</p>
            <ul style="font-size:0.9em; color: #795548;">
                <li>A4 vs SC1.1: 0.140 * 0.15 = 0.0210</li>
                <li>A4 vs SC1.2: 0.120 * 0.25 = 0.0300</li>
                <li>A4 vs SC1.3: 0.140 * 0.15 = 0.0210</li>
                <li>A4 vs SC2.1: 0.100 * 0.30 = 0.0300</li>
                <li>A4 vs SC2.3: 0.0875 * 0.35 = 0.030625</li>
                <li>A4 vs SC2.2: 0.0625 * 0.25 = 0.015625</li>
                <li>A4 vs SC4.3: 0.080 * 0.30 = 0.0240</li>
                <li>A4 vs SC4.2: 0.060 * 0.35 = 0.0210</li>
                <li>A4 vs SC4.1: 0.060 * 0.20 = 0.0120</li>
                <li>A4 vs SC3.2: 0.090 * 0.35 = 0.0315</li>
                <li>A4 vs SC3.1: 0.060 * 0.30 = 0.0180</li>
                <li><strong>Total for A4 (Flores Bajawa CB) = 0.021+0.03+0.021+0.03+0.030625+0.015625+0.024+0.021+0.012+0.0315+0.018 = 0.25475 (rounded to 0.2555 in summary for slight variation in example above, corrected here to match) => 0.2548 </strong></li>
            </ul>
            <p>Re-calculating all with consistent values based on the table:</p>
            <ul id="finalScoresRecalculated">
                 <li><span class="alternative-label">A1 (Gayo V60):</span> (0.140*0.30) + (0.120*0.15) + (0.140*0.25) + (0.100*0.20) + (0.0875*0.10) + (0.0625*0.30) + (0.080*0.20) + (0.060*0.15) + (0.060*0.25) + (0.090*0.15) + (0.060*0.10) = <span class="emphasis">0.2020</span></li>
                <li><span class="alternative-label">A2 (Mandailing FP):</span> (0.140*0.10) + (0.120*0.35) + (0.140*0.20) + (0.100*0.15) + (0.0875*0.20) + (0.0625*0.10) + (0.080*0.15) + (0.060*0.30) + (0.060*0.20) + (0.090*0.20) + (0.060*0.25) = <span class="emphasis">0.19775</span></li>
                <li><span class="alternative-label">A3 (Toraja V60):</span> (0.140*0.35) + (0.120*0.15) + (0.140*0.25) + (0.100*0.20) + (0.0875*0.10) + (0.0625*0.30) + (0.080*0.20) + (0.060*0.15) + (0.060*0.25) + (0.090*0.15) + (0.060*0.10) = <span class="emphasis">0.2090</span></li>
                <li><span class="alternative-label">A4 (Flores CB):</span> (0.140*0.15) + (0.120*0.25) + (0.140*0.15) + (0.100*0.30) + (0.0875*0.35) + (0.0625*0.25) + (0.080*0.30) + (0.060*0.35) + (0.060*0.20) + (0.090*0.35) + (0.060*0.30) = <span class="emphasis">0.25475</span></li>
                <li><span class="alternative-label">A5 (Gayo Tubruk):</span> (0.140*0.10) + (0.120*0.10) + (0.140*0.15) + (0.100*0.15) + (0.0875*0.25) + (0.0625*0.05) + (0.080*0.15) + (0.060*0.05) + (0.060*0.10) + (0.090*0.15) + (0.060*0.25) = <span class="emphasis">0.1365</span></li>
            </ul>

            <h3>Conclusion of Simulation</h3>
            <p>Based on our assumed weights and scores, <span class="alternative-label">Alternative 4: Flores Bajawa (Honey Processed) via Cold Brew</span> emerges as the top choice with the highest overall score (<span class="emphasis">0.2548</span>).</p>
            <p>This outcome suggests that its strong performance in novelty, perceived value, ethical story, processing impact, reproducibility, and ease of training, combined with decent flavor characteristics for a cold brew, outweighs the potentially higher clarity or aroma of V60 methods when all factors are considered according to our assigned priorities.</p>
            <p>A real AHP analysis would involve sensitivity analysis (checking how the outcome changes if weights are varied) to further build confidence in the decision.</p>
        </div>


            
        <div class="content-section">
            <h2>AHP Hierarchy Graph for Coffee Offering Selection</h2>
            <p>The following graph visualizes 4-level AHP structure for selecting a new single origin coffee feature. This is a simplified network representation to show the hierarchy. In a full AHP, weights would be assigned at each level based on pairwise comparisons.</p>
            <div id="ahpGraph"></div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const graphDiv = document.getElementById('ahpGraph');

            const ahpData = {
                nodes: [
                    // Level 1: Goal
                    { id: 'Goal', label: 'Select Optimal New Single<br>Origin Feature Offering', level: 1, group: 1, title: 'GOAL' },
                    // Level 2: Criteria
                    { id: 'C1', label: 'Exceptional Flavor<br>& Quality', level: 2, group: 2, title: 'CRITERION' },
                    { id: 'C2', label: 'Customer Appeal<br>& Uniqueness', level: 2, group: 2, title: 'CRITERION' },
                    { id: 'C3', label: 'Barista Skill<br>& Consistency', level: 2, group: 2, title: 'CRITERION' },
                    { id: 'C4', label: 'Sourcing Story<br>& Bean Characteristics', level: 2, group: 2, title: 'CRITERION' },
                    // Level 3: Sub-Criteria
                    { id: 'SC1.1', label: 'Clarity of Notes', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                    { id: 'SC1.2', label: 'Body & Mouthfeel', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                    { id: 'SC1.3', label: 'Aroma Intensity', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                    { id: 'SC2.1', label: 'Perceived Value', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                    { id: 'SC2.2', label: 'Instagrammability', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                    { id: 'SC2.3', label: 'Novelty Factor', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                    { id: 'SC3.1', label: 'Ease of Training', level: 3, group: 3, title: 'SUB-CRITERION (Skill)' },
                    { id: 'SC3.2', label: 'Reproducibility', level: 3, group: 3, title: 'SUB-CRITERION (Skill)' },
                    { id: 'SC4.1', label: 'Origin Reputation', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                    { id: 'SC4.2', label: 'Processing Impact', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                    { id: 'SC4.3', label: 'Ethical Story', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                    // Level 4: Alternatives
                    { id: 'A1', label: 'Aceh Gayo (Washed)<br>via V60', level: 4, group: 4, title: 'ALTERNATIVE 1' },
                    { id: 'A2', label: 'Mandailing (Dry)<br>via French Press', level: 4, group: 4, title: 'ALTERNATIVE 2' },
                    { id: 'A3', label: 'Toraja (Washed)<br>via V60', level: 4, group: 4, title: 'ALTERNATIVE 3' },
                    { id: 'A4', label: 'Flores Bajawa (Honey)<br>via Cold Brew', level: 4, group: 4, title: 'ALTERNATIVE 4' },
                    { id: 'A5', label: 'Aceh Gayo (Washed)<br>via Tubruk', level: 4, group: 4, title: 'ALTERNATIVE 5' }
                ],
                links: [
                    { source: 'Goal', target: 'C1' }, { source: 'Goal', target: 'C2' }, { source: 'Goal', target: 'C3' }, { source: 'Goal', target: 'C4' },
                    { source: 'C1', target: 'SC1.1' }, { source: 'C1', target: 'SC1.2' }, { source: 'C1', target: 'SC1.3' },
                    { source: 'C2', target: 'SC2.1' }, { source: 'C2', target: 'SC2.2' }, { source: 'C2', target: 'SC2.3' },
                    { source: 'C3', target: 'SC3.1' }, { source: 'C3', target: 'SC3.2' },
                    { source: 'C4', target: 'SC4.1' }, { source: 'C4', target: 'SC4.2' }, { source: 'C4', target: 'SC4.3' },
                ].concat(
                    ['SC1.1', 'SC1.2', 'SC1.3', 'SC2.1', 'SC2.2', 'SC2.3', 'SC3.1', 'SC3.2', 'SC4.1', 'SC4.2', 'SC4.3']
                    .flatMap(sc => ['A1', 'A2', 'A3', 'A4', 'A5'].map(alt => ({ source: sc, target: alt })))
                )
            };

            const nodeMap = new Map(ahpData.nodes.map((node, i) => [node.id, { ...node, index: i }]));

            const levels = {};
            ahpData.nodes.forEach(node => {
                if (!levels[node.level]) levels[node.level] = [];
                levels[node.level].push(node);
            });

            const xSpacing = 280;
            const ySpacing = 110;
            let maxYUsed = 0;
            let minYUsed = 0;

            Object.keys(levels).sort((a,b) => parseInt(a)-parseInt(b)).forEach((levelKey, levelIndex) => {
                const nodesInLevel = levels[levelKey];
                const levelWidth = (nodesInLevel.length - 1) * ySpacing;
                let startY = -levelWidth / 2;

                if (parseInt(levelKey) === 1) startY = 0;
                if (parseInt(levelKey) === 4) startY -= ySpacing * 1.2;

                nodesInLevel.forEach((node, nodeIndexInLevel) => {
                    node.x = levelIndex * xSpacing;
                    node.y = startY + nodeIndexInLevel * ySpacing;
                    if (node.y > maxYUsed) maxYUsed = node.y;
                    if (node.y < minYUsed) minYUsed = node.y;
                    const mappedNode = nodeMap.get(node.id);
                    if(mappedNode) {
                        mappedNode.x = node.x;
                        mappedNode.y = node.y;
                    }
                });
            });

            const initialEdgeShapes = ahpData.links.map((link, index) => {
                const sourceNode = nodeMap.get(link.source);
                const targetNode = nodeMap.get(link.target);
                 if (!sourceNode || !targetNode) {
                    console.warn(`Graph Snippet: Missing node for link: ${link.source} -> ${link.target}`);
                    return null;
                }
                return {
                    id: `link-${index}`,
                    type: 'line',
                    x0: sourceNode.x,
                    y0: sourceNode.y,
                    x1: targetNode.x,
                    y1: targetNode.y,
                    line: { color: '#757575', width: 1.5 },
                    opacity: 1
                };
            }).filter(shape => shape !== null);

            const traceNodes = {
                x: ahpData.nodes.map(n => nodeMap.get(n.id)?.x),
                y: ahpData.nodes.map(n => nodeMap.get(n.id)?.y),
                text: ahpData.nodes.map(n => `<b>${n.label.replace(/<br>/g, '\n')}</b>`),
                mode: 'markers+text',
                type: 'scatter',
                marker: {
                    size: ahpData.nodes.map(n => n.level === 1 ? 28 : (n.level === 4 ? 22 : 24)),
                    color: ahpData.nodes.map(n => {
                        if (n.level === 1) return '#E040FB'; // Bright Purple (Goal)
                        if (n.level === 2) return '#BA68C8'; // Medium Purple (Criteria)
                        if (n.level === 3) return '#4DB6AC'; // Teal (Sub-Criteria)
                        if (n.level === 4) return '#FFB74D'; // Amber (Alternatives)
                        return '#D1C4E9';
                    }),
                    symbol: ahpData.nodes.map(n => {
                        if (n.level === 1) return 'diamond-wide';
                        if (n.level === 2) return 'square';
                        if (n.level === 3) return 'circle';
                        if (n.level === 4) return 'hexagon';
                        return 'circle';
                    }),
                    line: { width: 2, color: '#F5F5F5' },
                    opacity: ahpData.nodes.map(() => 1)
                },
                textfont: {
                    family: 'Segoe UI, Tahoma, sans-serif',
                    size: 10,
                    color: '#FFFFFF'
                },
                textposition: 'middle right',
                hoverinfo: 'text',
                hovertext: ahpData.nodes.map(n => `<b>${n.title}</b><br>${n.label.replace(/<br>/g, ' ')}`),
                customdata: ahpData.nodes.map(n => ({ id: n.id }))
            };

            const layout = {
                title: {
                    text: 'AHP Hierarchy Graph', // Generic title for snippet
                    font: { size: 22, color: '#E040FB' },
                    y:0.95
                },
                shapes: initialEdgeShapes,
                xaxis: { showgrid: false, zeroline: false, showticklabels: false, range: [-xSpacing*0.5, xSpacing * 3.5 + 50] },
                yaxis: { showgrid: false, zeroline: false, showticklabels: false, range: [minYUsed - ySpacing, maxYUsed + ySpacing] },
                showlegend: false,
                hovermode: 'closest',
                paper_bgcolor: '#4E342E',
                plot_bgcolor: '#4E342E',
                margin: { t: 80, b: 40, l: 40, r: 40 },
                height: 750 // Adjusted height for a standalone snippet
            };

            Plotly.newPlot(graphDiv, [traceNodes], layout, {responsive: true});

            graphDiv.on('plotly_hover', function (eventData) {
                if (eventData.points.length > 0) {
                    const hoveredNodeIndex = eventData.points[0].pointNumber;
                    const hoveredNodeId = ahpData.nodes[hoveredNodeIndex].id;

                    const connectedLinkIds = [];
                    const connectedNodeIds = new Set([hoveredNodeId]);

                    ahpData.links.forEach((link,idx) => {
                        const sourceNode = nodeMap.get(link.source); // Check nodes exist
                        const targetNode = nodeMap.get(link.target);
                        if (!sourceNode || !targetNode) return;

                        if (link.source === hoveredNodeId) {
                            connectedNodeIds.add(link.target);
                            connectedLinkIds.push(`link-${idx}`);
                        }
                        if (link.target === hoveredNodeId) {
                            connectedNodeIds.add(link.source);
                            connectedLinkIds.push(`link-${idx}`);
                        }
                    });

                    const newMarkerOpacities = ahpData.nodes.map(n => connectedNodeIds.has(n.id) ? 1 : 0.2);
                    const newMarkerSizes = ahpData.nodes.map(n => {
                        if (n.id === hoveredNodeId) return n.level === 1 ? 32 : (n.level === 4 ? 26 : 28);
                        return n.level === 1 ? 28 : (n.level === 4 ? 22 : 24);
                    });

                    Plotly.restyle(graphDiv, {
                        'marker.opacity': [newMarkerOpacities],
                        'marker.size': [newMarkerSizes]
                    }, [0]);

                    const updatedShapes = initialEdgeShapes.map(shape => {
                        if (!shape) return null; // handle cases where a link shape might be null
                        const linkData = ahpData.links[parseInt(shape.id.split('-')[1])]; // get original link data by index
                        if (!linkData) return shape; // if link data not found, return original shape

                        const isConnected = (linkData.source === hoveredNodeId && connectedNodeIds.has(linkData.target)) ||
                                            (linkData.target === hoveredNodeId && connectedNodeIds.has(linkData.source));

                        return { ...shape, line: {...shape.line, width: isConnected ? 3 : 1.5, color: isConnected ? '#E040FB' : '#757575'}, opacity: isConnected ? 1 : 0.15 };
                    }).filter(shape => shape !== null);
                    Plotly.relayout(graphDiv, { shapes: updatedShapes });
                }
            });

            graphDiv.on('plotly_unhover', function (eventData) {
                Plotly.restyle(graphDiv, {
                    'marker.opacity': [ahpData.nodes.map(() => 1)],
                    'marker.size': [ahpData.nodes.map(n => n.level === 1 ? 28 : (n.level === 4 ? 22 : 24))]
                }, [0]);
                 const resetShapes = initialEdgeShapes.map(s => {
                    if (!s) return null;
                    return ({...s, line: {...s.line, width: 1.5, color: '#757575'}, opacity: 1});
                }).filter(shape => shape !== null);
                Plotly.relayout(graphDiv, { shapes: resetShapes });
            });
        });
        // --- NEW: Accordion for AHP Calculation Steps ---
        const calculationSection = document.querySelector('.content-section:has(h2#ahpCalculationSteps)'); // More robust selector
        if (calculationSection) {
            const stepsHeadings = calculationSection.querySelectorAll('h3');

            stepsHeadings.forEach(heading => {
                // Style heading to indicate it's clickable
                heading.style.cursor = 'pointer';
                heading.style.position = 'relative'; // For positioning the toggle icon

                // Create toggle icon
                const toggleIcon = document.createElement('span');
                toggleIcon.innerHTML = ' ▼'; // Down arrow for collapsed
                toggleIcon.style.position = 'absolute';
                toggleIcon.style.right = '10px';
                toggleIcon.style.transition = 'transform 0.3s ease';
                heading.appendChild(toggleIcon);


                // Get content to toggle (all elements between this h3 and the next h3 or end of section)
                let contentToToggle = [];
                let nextElement = heading.nextElementSibling;
                while (nextElement && nextElement.tagName !== 'H3') {
                    contentToToggle.push(nextElement);
                    nextElement = nextElement.nextElementSibling;
                }

                // Initially hide content (except for the first step)
                if (heading.id !== "step1CriteriaWeights") { // Keep first step open by default
                    contentToToggle.forEach(el => el.style.display = 'none');
                    toggleIcon.innerHTML = ' ▶'; // Right arrow for expanded
                    toggleIcon.style.transform = 'rotate(-90deg)';
                } else {
                     toggleIcon.innerHTML = ' ▼';
                     toggleIcon.style.transform = 'rotate(0deg)';
                }


                heading.addEventListener('click', () => {
                    const isHidden = contentToToggle[0] && contentToToggle[0].style.display === 'none';
                    contentToToggle.forEach(el => {
                        el.style.display = isHidden ? '' : 'none'; // Toggle display
                    });
                    // Update icon
                    if (isHidden) {
                        toggleIcon.innerHTML = ' ▼';
                        toggleIcon.style.transform = 'rotate(0deg)';
                    } else {
                        toggleIcon.innerHTML = ' ▶';
                        toggleIcon.style.transform = 'rotate(-90deg)';
                    }
                });
            });
        }

        // --- NEW: Interactive Final Score Calculation Display ---
        const finalScoresList = document.getElementById('finalScoresRecalculated');
        if (finalScoresList) {
            const scoreItems = finalScoresList.querySelectorAll('li');
            scoreItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.title = 'Click to see detailed calculation for this alternative'; // Tooltip

                item.addEventListener('mouseenter', () => {
                    item.style.backgroundColor = '#6D4C41'; // Slightly lighter brown on hover
                    item.style.transition = 'background-color 0.3s ease';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.backgroundColor = '';
                });

                item.addEventListener('click', function() {
                    const altId = this.querySelector('.alternative-label').textContent.split(':')[0].trim(); // e.g., "A1"
                    // Remove any existing calculation display
                    const existingDetail = document.getElementById('dynamicCalcDetail');
                    if (existingDetail) {
                        existingDetail.remove();
                    }

                    const detailDiv = document.createElement('div');
                    detailDiv.id = 'dynamicCalcDetail';
                    detailDiv.style.backgroundColor = '#4E342E'; // Match graph bg
                    detailDiv.style.padding = '15px';
                    detailDiv.style.marginTop = '10px';
                    detailDiv.style.border = '1px solid #7E57C2'; // Purple border
                    detailDiv.style.borderRadius = '8px';
                    detailDiv.style.color = '#F5F5F5'; // White text
                    detailDiv.style.fontSize = '0.9em';

                    let calculationHTML = `<h4>Detailed Calculation for ${this.querySelector('.alternative-label').textContent}</h4><ul>`;

                    // Assumed structure from your "Step 4" table and "Step 3" global weights
                    // These would ideally come from a JS data structure if the page was fully dynamic
                    const globalWeights = {
                        'SC1.1': 0.140, 'SC1.2': 0.120, 'SC1.3': 0.140,
                        'SC2.1': 0.100, 'SC2.3': 0.0875, 'SC2.2': 0.0625,
                        'SC4.3': 0.080, 'SC4.2': 0.060, 'SC4.1': 0.060,
                        'SC3.2': 0.090, 'SC3.1': 0.060
                    };

                    // Scores from your table (example for A1 and A4 shown, you'd need all)
                    const altScores = {
                        'A1': {'SC1.1':0.30, 'SC1.2':0.15, 'SC1.3':0.25, 'SC2.1':0.20, 'SC2.3':0.10, 'SC2.2':0.30, 'SC4.3':0.20, 'SC4.2':0.15, 'SC4.1':0.25, 'SC3.2':0.15, 'SC3.1':0.10},
                        'A2': {'SC1.1':0.10, 'SC1.2':0.35, 'SC1.3':0.20, 'SC2.1':0.15, 'SC2.3':0.20, 'SC2.2':0.10, 'SC4.3':0.15, 'SC4.2':0.30, 'SC4.1':0.20, 'SC3.2':0.20, 'SC3.1':0.25},
                        'A3': {'SC1.1':0.35, 'SC1.2':0.15, 'SC1.3':0.25, 'SC2.1':0.20, 'SC2.3':0.10, 'SC2.2':0.30, 'SC4.3':0.20, 'SC4.2':0.15, 'SC4.1':0.25, 'SC3.2':0.15, 'SC3.1':0.10},
                        'A4': {'SC1.1':0.15, 'SC1.2':0.25, 'SC1.3':0.15, 'SC2.1':0.30, 'SC2.3':0.35, 'SC2.2':0.25, 'SC4.3':0.30, 'SC4.2':0.35, 'SC4.1':0.20, 'SC3.2':0.35, 'SC3.1':0.30},
                        'A5': {'SC1.1':0.10, 'SC1.2':0.10, 'SC1.3':0.15, 'SC2.1':0.15, 'SC2.3':0.25, 'SC2.2':0.05, 'SC4.3':0.15, 'SC4.2':0.05, 'SC4.1':0.10, 'SC3.2':0.15, 'SC3.1':0.25}
                    };

                    let totalScore = 0;
                    if (altScores[altId]) {
                        for (const scId in globalWeights) {
                            if (altScores[altId].hasOwnProperty(scId)) {
                                const gw = globalWeights[scId];
                                const as = altScores[altId][scId];
                                const weightedScore = gw * as;
                                totalScore += weightedScore;
                                calculationHTML += `<li>vs ${scId}: (${gw.toFixed(4)} × ${as.toFixed(2)}) = ${weightedScore.toFixed(5)}</li>`;
                            }
                        }
                        calculationHTML += `</ul><p style="font-weight:bold; color:#E040FB;">Total Score: ${totalScore.toFixed(5)}</p>`;
                    } else {
                        calculationHTML = `<p>Detailed scores for ${altId} not fully defined in this example script.</p>`;
                    }
                    detailDiv.innerHTML = calculationHTML;
                    this.parentNode.insertBefore(detailDiv, this.nextSibling); // Insert after the clicked item
                });
            });
        }

        // --- NEW: Highlight winning alternative ---
        const scoresListForHighlight = document.getElementById('finalScoresRecalculated');
        if (scoresListForHighlight) {
            let highestScore = -1;
            let winningItem = null;
            scoresListForHighlight.querySelectorAll('li').forEach(item => {
                const scoreText = item.querySelector('.emphasis').textContent;
                const score = parseFloat(scoreText);
                if (score > highestScore) {
                    highestScore = score;
                    winningItem = item;
                }
            });
            if (winningItem) {
                winningItem.style.border = '2px solid #E040FB'; // Bright purple border
                winningItem.style.boxShadow = '0 0 10px #E040FB';
                winningItem.style.padding = '8px';
                winningItem.style.borderRadius = '8px';
                const winnerLabel = winningItem.querySelector('.alternative-label');
                if(winnerLabel) {
                     winnerLabel.innerHTML += ' <span style="color:#FFB74D; font-size:0.9em;">(Highest Score)</span>';
                }
            }
        }

        // Add IDs to H3 elements in the calculation section if they don't have them, for accordion to work
        const calcSectionForIds = document.querySelector('.content-section:has(h2#ahpCalculationSteps)');
        if (calcSectionForIds) {
            const h3s = calcSectionForIds.querySelectorAll('h3');
            h3s.forEach((h3, index) => {
                if (!h3.id) {
                    // Create a simple ID based on the step number
                    // Ensure the H2 has the ID 'ahpCalculationSteps'
                    const h2Title = h3.closest('.content-section').querySelector('h2');
                    if (h2Title && h2Title.textContent.includes("AHP Calculation Simulation")) {
                         h2Title.id = "ahpCalculationSteps"; // Ensure the main h2 has this ID
                    }

                    // Assign IDs to H3s for accordion logic
                    if (h3.textContent.includes("Step 1:")) h3.id = "step1CriteriaWeights";
                    else if (h3.textContent.includes("Step 2:")) h3.id = "step2SubCriteriaWeights";
                    else if (h3.textContent.includes("Step 3:")) h3.id = "step3GlobalWeights";
                    else if (h3.textContent.includes("Step 4:")) h3.id = "step4ScoringAlternatives";
                    else if (h3.textContent.includes("Step 5:")) h3.id = "step5FinalScores";
                    // Add more else if for other H3s if needed
                }
            });
        }


    });
</script>
</body>
</html>
