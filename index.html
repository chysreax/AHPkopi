<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHP Analysis: Specialized Coffee Offering</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #3E2723; /* Darkest Brown */
            color: #F5F5F5; /* Off-White */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #4A0072; /* Dark Deep Purple */
            color: #FFFFFF; /* White */
            padding: 25px 0;
            text-align: center;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3); /* Subtle purple glow */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 600;
        }

        h2 {
            color: #BA68C8; /* Medium Purple */
            border-bottom: 2px solid #7E57C2; /* Deeper Purple */
            padding-bottom: 10px;
            margin-top: 40px;
            font-size: 2em;
        }

        h3 {
            color: #D1C4E9; /* Lighter Purple */
            margin-top: 30px;
            font-size: 1.4em;
        }

        .content-section {
            background-color: #5D4037; /* Dark Brown - lighter than body */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .content-section ul {
            list-style-type: disc;
            padding-left: 25px;
        }

        .content-section li {
            margin-bottom: 12px;
            font-size: 1.05em;
        }
        .content-section p {
            font-size: 1.05em;
            margin-bottom: 15px;
        }

        #ahpGraphContainer { /* Added a container for potential responsive graph sizing */
            width: 100%;
            border-radius: 15px;
            background-color: #4E342E; /* Slightly different dark brown for graph bg */
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #ahpGraph {
             width: 100%;
             /* height is set dynamically by Plotly or can be fixed */
        }


        .code-like {
            font-family: 'Courier New', Courier, monospace;
            background-color: #6D4C41; /* Brown, slightly lighter than section bg */
            padding: 3px 6px;
            border-radius: 5px;
            color: #F5F5F5; /* Off-white */
            font-size: 0.95em;
        }

        strong {
            color: #BA68C8; /* Medium Purple for emphasis */
            font-weight: 600;
        }

        a {
            color: #CE93D8; /* Lighter Purple for links */
            text-decoration: none;
        }
        a:hover {
            color: #AB47BC; /* Medium Purple on hover */
            text-decoration: underline;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #5D4037; /* Dark Brown */
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #7B1FA2; /* Medium Purple */
            border-radius: 10px;
            border: 2px solid #5D4037; /* Creates a nice border effect */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9C27B0; /* Brighter Purple */
        }

    </style>
</head>
<body>
    <header>
        <h1>AHP Analysis: Selecting a Specialized Coffee Offering</h1>
    </header>

    <div class="container">
        <div class="content-section">
            <h2>Understanding Your Initial Coffee Diagram & AHP Revision</h2>
            <p>Your initial diagram was an excellent mind map showing various elements related to specialized coffee, including brewing methods, bean origins, and processing techniques. It effectively illustrated the relationships and categories within this domain.</p>
            <p>However, to frame it as a formal <strong>Analytical Hierarchy Process (AHP)</strong>, some restructuring is beneficial. AHP is a structured technique for organizing and analyzing complex decisions, based on mathematics and psychology. It helps decision-makers set priorities and make the best decision when both qualitative and quantitative aspects of a decision need to be considered.</p>

            <h3>Original Diagram Observations in an AHP Context:</h3>
            <ul>
                <li><strong>Goal Misalignment:</strong> The top element "Specialized Coffee" acted more as the general topic rather than a specific decision-making goal (e.g., "Select the Best Coffee Offering for X Purpose").</li>
                <li><strong>Categorization vs. Evaluation:</strong> Elements like brewing methods ("Manual", "Mesin") and bean origins were categorized, but not set up within a clear evaluative hierarchy for a specific choice.</li>
                <li><strong>Multi-directional Relationships:</strong> Coffee beans were linked to multiple brewing methods. While true in reality, AHP follows a more directional top-down flow for evaluation: Goal → Criteria → Sub-Criteria → Alternatives.</li>
                <li><strong>Nature of Elements:</strong> The levels mixed processes (brewing), inputs (beans), and attributes (processing). AHP typically uses levels for evaluative factors and the final level for the distinct choices (alternatives).</li>
            </ul>

            <h3>Corrections Made for a Clearer AHP Structure:</h3>
            <p>To transform this into a standard AHP, we defined a specific, actionable business decision: <strong>A specialty coffee shop aims to introduce a new premium "Single Origin Feature" coffee offering and needs to select the optimal combination of bean and its ideal manual brewing method.</strong></p>
            <p>The revised AHP structure, as visualized in the interactive graph below, is:</p>
            <ul>
                <li><strong>Level 1: Goal</strong> - The ultimate objective: Select the Optimal New Single Origin Feature Offering.</li>
                <li><strong>Level 2: Criteria</strong> - The main high-level factors crucial for making the decision (e.g., <strong>Exceptional Flavor & Quality</strong>, <strong>Customer Appeal & Uniqueness</strong>, <strong>Barista Skill & Consistency</strong>, <strong>Sourcing Story & Bean Characteristics</strong>). These are weighted based on importance.</li>
                <li><strong>Level 3: Sub-Criteria</strong> - More specific, measurable aspects that break down each criterion (e.g., for "Exceptional Flavor," sub-criteria could be <strong>Clarity of Notes</strong>, <strong>Body & Mouthfeel</strong>, <strong>Aroma Intensity</strong>). These are also weighted relative to their parent criterion.</li>
                <li><strong>Level 4: Alternatives</strong> - The distinct, comparable choices being evaluated (e.g., "Aceh Gayo (Washed) via V60," "Flores Bajawa (Honey Processed) via Cold Brew"). Each alternative is scored against each sub-criterion.</li>
            </ul>
            <p>This structured approach allows for a systematic pairwise comparison (not shown in the graph, but a core AHP step) to derive numerical weights for criteria and scores for alternatives, leading to a quantitatively supported best choice.</p>
        </div>

        <div class="content-section">
            <h2>Interactive AHP Hierarchy Graph</h2>
            <p>The following graph visualizes the revised 4-level AHP structure. Hover over nodes to highlight their connections and dim unrelated elements. This helps in understanding the relationships within the decision hierarchy. (Zoom and Pan are also enabled).</p>
            <div id="ahpGraphContainer">
                <div id="ahpGraph"></div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const graphDiv = document.getElementById('ahpGraph');

            const ahpData = {
                nodes: [
                    // Level 1: Goal
                    { id: 'Goal', label: 'Select Optimal New Single<br>Origin Feature Offering', level: 1, group: 1, title: 'GOAL' },
                    // Level 2: Criteria
                    { id: 'C1', label: 'Exceptional Flavor<br>& Quality', level: 2, group: 2, title: 'CRITERION' },
                    { id: 'C2', label: 'Customer Appeal<br>& Uniqueness', level: 2, group: 2, title: 'CRITERION' },
                    { id: 'C3', label: 'Barista Skill<br>& Consistency', level: 2, group: 2, title: 'CRITERION' },
                    { id: 'C4', label: 'Sourcing Story<br>& Bean Characteristics', level: 2, group: 2, title: 'CRITERION' },
                    // Level 3: Sub-Criteria
                    { id: 'SC1.1', label: 'Clarity of Notes', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                    { id: 'SC1.2', label: 'Body & Mouthfeel', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                    { id: 'SC1.3', label: 'Aroma Intensity', level: 3, group: 3, title: 'SUB-CRITERION (Flavor)' },
                    { id: 'SC2.1', label: 'Perceived Value', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                    { id: 'SC2.2', label: 'Instagrammability', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                    { id: 'SC2.3', label: 'Novelty Factor', level: 3, group: 3, title: 'SUB-CRITERION (Appeal)' },
                    { id: 'SC3.1', label: 'Ease of Training', level: 3, group: 3, title: 'SUB-CRITERION (Skill)' },
                    { id: 'SC3.2', label: 'Reproducibility', level: 3, group: 3, title: 'SUB-CRITERION (Skill)' },
                    { id: 'SC4.1', label: 'Origin Reputation', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                    { id: 'SC4.2', label: 'Processing Impact', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                    { id: 'SC4.3', label: 'Ethical Story', level: 3, group: 3, title: 'SUB-CRITERION (Sourcing)' },
                    // Level 4: Alternatives
                    { id: 'A1', label: 'Aceh Gayo (Washed)<br>via V60', level: 4, group: 4, title: 'ALTERNATIVE 1' },
                    { id: 'A2', label: 'Mandailing (Dry)<br>via French Press', level: 4, group: 4, title: 'ALTERNATIVE 2' },
                    { id: 'A3', label: 'Toraja (Washed)<br>via V60', level: 4, group: 4, title: 'ALTERNATIVE 3' },
                    { id: 'A4', label: 'Flores Bajawa (Honey)<br>via Cold Brew', level: 4, group: 4, title: 'ALTERNATIVE 4' },
                    { id: 'A5', label: 'Aceh Gayo (Washed)<br>via Tubruk', level: 4, group: 4, title: 'ALTERNATIVE 5' }
                ],
                links: [
                    { source: 'Goal', target: 'C1' }, { source: 'Goal', target: 'C2' }, { source: 'Goal', target: 'C3' }, { source: 'Goal', target: 'C4' },
                    { source: 'C1', target: 'SC1.1' }, { source: 'C1', target: 'SC1.2' }, { source: 'C1', target: 'SC1.3' },
                    { source: 'C2', target: 'SC2.1' }, { source: 'C2', target: 'SC2.2' }, { source: 'C2', target: 'SC2.3' },
                    { source: 'C3', target: 'SC3.1' }, { source: 'C3', target: 'SC3.2' },
                    { source: 'C4', target: 'SC4.1' }, { source: 'C4', target: 'SC4.2' }, { source: 'C4', target: 'SC4.3' },
                ].concat(
                    ['SC1.1', 'SC1.2', 'SC1.3', 'SC2.1', 'SC2.2', 'SC2.3', 'SC3.1', 'SC3.2', 'SC4.1', 'SC4.2', 'SC4.3']
                    .flatMap(sc => ['A1', 'A2', 'A3', 'A4', 'A5'].map(alt => ({ source: sc, target: alt })))
                )
            };

            const nodeMap = new Map(ahpData.nodes.map((node, i) => [node.id, { ...node, index: i }]));

            const levels = {};
            ahpData.nodes.forEach(node => {
                if (!levels[node.level]) levels[node.level] = [];
                levels[node.level].push(node);
            });

            const xSpacing = 280; // Increased spacing
            const ySpacing = 110; // Adjusted for visual balance
            let maxYUsed = 0;
            let minYUsed = 0;


            Object.keys(levels).sort((a,b) => parseInt(a)-parseInt(b)).forEach((levelKey, levelIndex) => {
                const nodesInLevel = levels[levelKey];
                const levelWidth = (nodesInLevel.length - 1) * ySpacing;
                let startY = -levelWidth / 2;

                if (parseInt(levelKey) === 1) startY = 0; // Center Goal
                if (parseInt(levelKey) === 4) startY -= ySpacing * 1.2; // Adjust Alternatives slightly

                nodesInLevel.forEach((node, nodeIndexInLevel) => {
                    node.x = levelIndex * xSpacing;
                    node.y = startY + nodeIndexInLevel * ySpacing;
                    if (node.y > maxYUsed) maxYUsed = node.y;
                    if (node.y < minYUsed) minYUsed = node.y;
                });
            });
            // Ensure all nodes have x, y
             ahpData.nodes.forEach(n_orig => {
                let mapped_node = nodeMap.get(n_orig.id);
                if(mapped_node) {
                    n_orig.x = mapped_node.x;
                    n_orig.y = mapped_node.y;
                }
             });


            const initialEdgeShapes = ahpData.links.map((link, index) => {
                const sourceNode = nodeMap.get(link.source);
                const targetNode = nodeMap.get(link.target);
                return {
                    id: `link-${index}`, // Unique ID for each shape
                    type: 'line',
                    x0: sourceNode.x,
                    y0: sourceNode.y,
                    x1: targetNode.x,
                    y1: targetNode.y,
                    line: { color: '#757575', width: 1.5 }, // Neutral light grey for links
                    opacity: 1
                };
            });

            const traceNodes = {
                x: ahpData.nodes.map(n => n.x),
                y: ahpData.nodes.map(n => n.y),
                text: ahpData.nodes.map(n => `<b>${n.label.replace(/<br>/g, '\n')}</b>`),
                mode: 'markers+text',
                type: 'scatter',
                marker: {
                    size: ahpData.nodes.map(n => n.level === 1 ? 28 : (n.level === 4 ? 22 : 24)), // Goal larger, Alts slightly smaller
                    color: ahpData.nodes.map(n => {
                        if (n.level === 1) return '#E040FB'; // Bright Purple (Goal)
                        if (n.level === 2) return '#BA68C8'; // Medium Purple (Criteria)
                        if (n.level === 3) return '#4DB6AC'; // Teal (Sub-Criteria)
                        if (n.level === 4) return '#FFB74D'; // Amber (Alternatives)
                        return '#D1C4E9';
                    }),
                    symbol: ahpData.nodes.map(n => {
                        if (n.level === 1) return 'diamond-wide';
                        if (n.level === 2) return 'square';
                        if (n.level === 3) return 'circle';
                        if (n.level === 4) return 'hexagon';
                        return 'circle';
                    }),
                    line: { width: 2, color: '#F5F5F5' }, // White border for markers
                    opacity: ahpData.nodes.map(() => 1) // Initial opacity
                },
                textfont: {
                    family: 'Segoe UI, Tahoma, sans-serif',
                    size: 10,
                    color: '#FFFFFF'
                },
                textposition: 'middle right',
                hoverinfo: 'text', // Use hovertext for custom tooltip
                hovertext: ahpData.nodes.map(n => `<b>${n.title}</b><br>${n.label.replace(/<br>/g, ' ')}`),
                customdata: ahpData.nodes.map(n => ({ id: n.id })) // Store node ID for hover events
            };

            const layout = {
                title: {
                    text: 'Interactive AHP Hierarchy: Coffee Offering Selection',
                    font: { size: 22, color: '#E040FB' /* Bright Purple */ },
                    y:0.95 // Adjust title position
                },
                shapes: initialEdgeShapes,
                xaxis: { showgrid: false, zeroline: false, showticklabels: false, range: [-xSpacing*0.5, xSpacing * 3.5 + 50] },
                yaxis: { showgrid: false, zeroline: false, showticklabels: false, range: [minYUsed - ySpacing, maxYUsed + ySpacing] },
                showlegend: false,
                hovermode: 'closest',
                paper_bgcolor: '#4E342E', // Graph area background
                plot_bgcolor: '#4E342E',
                margin: { t: 80, b: 40, l: 40, r: 40 },
                height: 850 // Increased height
            };

            Plotly.newPlot(graphDiv, [traceNodes], layout, {responsive: true});

            graphDiv.on('plotly_hover', function (eventData) {
                if (eventData.points.length > 0) {
                    const hoveredNodeIndex = eventData.points[0].pointNumber;
                    const hoveredNodeId = ahpData.nodes[hoveredNodeIndex].id;

                    const connectedLinkIds = [];
                    const connectedNodeIds = new Set([hoveredNodeId]);

                    ahpData.links.forEach((link,idx) => {
                        if (link.source === hoveredNodeId) {
                            connectedNodeIds.add(link.target);
                            connectedLinkIds.push(`link-${idx}`);
                        }
                        if (link.target === hoveredNodeId) {
                            connectedNodeIds.add(link.source);
                            connectedLinkIds.push(`link-${idx}`);
                        }
                    });

                    const newMarkerOpacities = ahpData.nodes.map(n => connectedNodeIds.has(n.id) ? 1 : 0.2);
                    const newMarkerSizes = ahpData.nodes.map(n => {
                        if (n.id === hoveredNodeId) return n.level === 1 ? 32 : (n.level === 4 ? 26 : 28); // Emphasize hovered
                        return n.level === 1 ? 28 : (n.level === 4 ? 22 : 24); // Default sizes
                    });


                    Plotly.restyle(graphDiv, {
                        'marker.opacity': [newMarkerOpacities],
                        'marker.size': [newMarkerSizes]
                    }, [0]); // 0 refers to the first trace (traceNodes)

                    const updatedShapes = initialEdgeShapes.map(shape => {
                        const isConnected = ahpData.links.some((link, idx) =>
                            `link-${idx}` === shape.id && (connectedNodeIds.has(link.source) && connectedNodeIds.has(link.target) && (link.source === hoveredNodeId || link.target === hoveredNodeId))
                        );
                        return { ...shape, line: {...shape.line, width: isConnected ? 3 : 1.5, color: isConnected ? '#E040FB' : '#757575'}, opacity: isConnected ? 1 : 0.15 };
                    });
                    Plotly.relayout(graphDiv, { shapes: updatedShapes });
                }
            });

            graphDiv.on('plotly_unhover', function (eventData) {
                Plotly.restyle(graphDiv, {
                    'marker.opacity': [ahpData.nodes.map(() => 1)],
                    'marker.size': [ahpData.nodes.map(n => n.level === 1 ? 28 : (n.level === 4 ? 22 : 24))]
                }, [0]);
                Plotly.relayout(graphDiv, { shapes: initialEdgeShapes.map(s => ({...s, line: {...s.line, width: 1.5, color: '#757575'}, opacity: 1})) });
            });

        });
    </script>
</body>
</html>
